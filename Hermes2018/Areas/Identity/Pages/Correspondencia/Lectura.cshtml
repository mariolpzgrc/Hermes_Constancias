@page "/Correspondencia/Lectura/{id:int}/{tipo:int}"
@model LecturaModel

@section Styles
    {
<link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.25.0/codemirror.min.css">
<link type="text/css" rel="stylesheet" href="~/lib/froala-editor/css/froala_editor.pkgd.min.css" />
<link type="text/css" rel="stylesheet" href="~/lib/froala-editor/css/froala_style.min.css" />
<link type="text/css" rel="stylesheet" href="~/lib/froala-editor/css/plugins/image.min.css" />
<link type="text/css" rel="stylesheet" href="~/lib/froala-editor/css/themes/gray.min.css" />
<link type="text/css" rel="stylesheet" href="~/lib/tagify/css/tagify.css" />
    @*<link href="~/lib/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet" />*@
<link href="~/lib/bootstrap-select-1.13.14/dist/css/bootstrap-select.min.css" rel="stylesheet" />

<link rel="stylesheet" href="~/lib/flatpickr/flatpickr.min.css">

<link type="text/css" rel="stylesheet" href="~/lib/easy-autocomplete/dist/easy-autocomplete.min.css" />
<link type="text/css" rel="stylesheet" href="~/lib/easy-autocomplete/dist/easy-autocomplete.themes.min.css" />
<link type="text/css" rel="stylesheet" href="~/lib/max-favilli-tagmanager/tagmanager.min.css" />
<link type="text/css" rel="stylesheet" href="~/lib/bootstrap-notify/animate.min.css" />
<link type="text/css" rel="stylesheet" href="~/css/Areas/Identity/Pages/Correspondencia/Lectura.min.css" asp-append-version="true" />
}

@section ScriptsPrioritarios
    {
<script type="text/javascript" src="~/lib/max-favilli-tagmanager/tagmanager.js"></script>

<script src="~/lib/flatpickr/flatpickr.min.js"></script>
<script src="~/lib/flatpickr/l10n/es.js"></script>


<script type="text/javascript" src="~/lib/jspdf/jspdf.min.js"></script>
<script type="text/javascript" src="~/lib/html2canvas/html2canvas.js"></script>
    @*<script type="text/javascript" src="~/lib/jspdf-autotable/jspdf.plugin.autotable.min.js"></script>*@
<script type="text/javascript" src="~/lib/bootstrap-notify/bootstrap-notify.min.js"></script>
<script type="text/javascript" src="~/lib/tagify/js/tagify.min.js"></script>

    @*select with search*@
<script src="~/lib/bootstrap-select-1.13.14/dist/js/bootstrap-select.min.js"></script>
}

<div class="content-wrapper pt-3">
    <div class="container-fluid">
        <div class="row">
            <div class="modal fade" id="ModalCorreo" tabindex="-1" role="dialog" aria-labelledby="ModalCorreoLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="ModalCorreoLabel">Enviar por correo electrónico</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form method="post">
                                <input class="sin-indicador" asp-for="EnvioCorreo.EnvioId" />
                                <input class="sin-indicador" asp-for="EnvioCorreo.Tipo" />
                                <input class="sin-indicador" asp-for="EnvioCorreo.Tipo" />

                                <input class="sin-indicador" asp-for="EnvioCorreo.TipoEnvio" />
                                <div class="form-group row font-dark-gray mb-0 mt-1">
                                    <span id="containerMailsFor" class="ml-3"></span>
                                    <span class="span-fill col-sm-12 mt-1" id="tagsEmailPara">
                                        <label class="lbl-para" id="labelPara"><b>Correo: </b></label>
                                        <label class="label-fill">
                                            <input id="form-autocomplete-para" type="text" placeholder="Destinatario" />
                                            <input asp-for="EnvioCorreo.Correo" class="form-control sin-indicador" />
                                            <span asp-validation-for="EnvioCorreo.Correo" class="text-danger"></span>
                                        </label>
                                    </span>
                                </div>
                                <div class="form-group col-12 font-dark-gray mb-0 mt-1">
                                    <label class="label-fill">
                                        <input type="checkbox" class="form-check-input sin-indicador" asp-for="EnvioCorreo.Adjuntar" id="adjuntar" checked>
                                        <label class="form-check-label" for="adjuntar">Incluir datos adjuntos</label>
                                    </label>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                                    <button type="submit" class="btn btn-primary" id="enviarEmail">Enviar</button>
                                </div>
                            </form>
                            <p class="text-center">
                                <a data-toggle="collapse" href="#collapseExample" role="button" aria-expanded="true" aria-controls="collapseExample">
                                    <small>Historial</small>
                                </a>
                            </p>
                            <div class="collapse show historial-correo" id="collapseExample">
                                <div class="table-responsive">
                                    <table class="table table-hover border-bottom table-sm responsive">
                                        <thead class="bg-light">
                                            <tr>
                                                <th width="130px">
                                                    <small>Fecha</small>
                                                </th>
                                                <th width="150px">
                                                    <small>Destinatario</small>
                                                </th>
                                                <th width="130px">
                                                    <small>Remitente</small>
                                                </th>
                                                <th width="130px">
                                                    <small>Delegado</small>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var historial in Model.ListadoHistorialCorreo)
                                            {
                                                <tr>
                                                    <td>
                                                        <small>@historial.Fecha</small>
                                                    </td>
                                                    <td>
                                                        <small>@historial.Destinatario.Replace(",", ",\n")</small>
                                                    </td>
                                                    <td>
                                                        <small>@historial.Remitente</small>
                                                    </td>
                                                    <td>
                                                        <small>@historial.EsDelegado</small>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-9 col-lg-12 col-xl-10 pb-3">
                <!-- nuevo breadcrumb -->
                <ol class="breadcrumb-2 mt-0 mb-0 display-inline">
                    <li class="breadcrumb-2-item active display-flex font-weight-bold">
                        LECTURA
                    </li>
                    <li>
                        @TempData["consulta"]
                        <input asp-for="InfoDelegar.EstaActiva" class="sin-indicador" />
                        <input asp-for="InfoDelegar.TipoPermiso" class="sin-indicador" />

                        <input asp-for="Envio.Actual_RecepcionId" class="sin-indicador" />
                    </li>
                    <li class="flex-right">

                        @if (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Envio)
                        {
                            if ((Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN4) && !Model.Envio.Actual_EsReenvio)
                            {
                                if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                                {
                                    <a asp-area="Identity" asp-page="/Correspondencia/Reenviar" asp-route-id="@Model.Envio.Actual_EnvioId" asp-route-tipo="@Model.Envio.Actual_Visualizacion_Tipo" class="md-btn md-btn-raised md-btn-ripple  mr-1" title="Reenviar el documento actual">Reenviar</a>
                                }
                            }
                        }
                        else if (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Recepcion)
                        {
                            @if (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN2)
                            {
                                if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                                {
                                    if (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN2)
                                    {
                                        if (Model.Envio.Actual_TieneRespuesta)
                                        {
                                            <a asp-area="Identity" asp-page="/Correspondencia/Turnar" asp-route-id="@Model.Envio.Actual_EnvioId" class="md-btn md-btn-raised md-btn-ripple bg-secondary mr-1" id="turnarBtn" title="Turnar este documento">Turnar</a>
                                        }
                                        else if (Model.EstaFechaCambiada)
                                        {
                                            <a asp-area="Identity" asp-page="/Correspondencia/Turnar" asp-route-id="@Model.Envio.Actual_EnvioId" class="md-btn md-btn-raised md-btn-ripple bg-secondary mr-1" id="turnarBtn" title="Turnar este documento">Turnar</a>
                                        }
                                        else
                                        {

                                            <a disabled asp-area="Identity" asp-page="/Correspondencia/Turnar" asp-route-id="@Model.Envio.Actual_EnvioId" class="md-btn md-btn-raised md-btn-ripple font-dark-gray bg-gray mr-1 disabled" id="turnarBtn" title="Para turnar este documento primero debes de cambiar la fecha">Turnar</a>
                                        }
                                    }
                                    else
                                    {
                                        <a asp-area="Identity" asp-page="/Correspondencia/Turnar" asp-route-id="@Model.Envio.Actual_EnvioId" class="md-btn md-btn-raised md-btn-ripple bg-secondary mr-1" id="turnarBtn" title="Turnar este documento">Turnar</a>
                                    }

                                }

                                if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                                {
                                    <a asp-area="Identity" asp-page="/Correspondencia/Responder" asp-route-id="@Model.Envio.Actual_EnvioId" class="md-btn md-btn-raised md-btn-ripple mr-1" id="responderEnviar" title="Responder al remitente de este documento">Responder</a>
                                }
                            }
                            else if ((Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN3) && (Model.Envio.Actual_UsuarioLee_Tipo == ConstTipoDestinatario.TipoDestinatarioN1 || Model.Envio.Actual_UsuarioLee_Tipo == ConstTipoDestinatario.TipoDestinatarioN2))
                            {
                                if (Model.Envio.Actual_UsuarioLee_Tipo == ConstTipoDestinatario.TipoDestinatarioN1)
                                {
                                    <a asp-area="Identity" asp-page="/Correspondencia/Lectura" asp-route-id="@Model.Envio.Origen_EnvioId" asp-route-tipo="@Model.Envio.Origen_TipoEnvioId" class="md-btn md-btn-raised md-btn-ripple bg-secondary mr-1" title="Ver el documento al que se le da respuesta">Ver origen</a>
                                }

                                if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                                {
                                    <a asp-area="Identity" asp-page="/Correspondencia/Responder" asp-route-id="@Model.Envio.Actual_EnvioId" class="md-btn md-btn-raised md-btn-ripple mr-1" id="responderEnviar" title="Responder al remitente de este documento">Responder</a>
                                }
                            }
                            else if ((Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN4))
                            {
                                if (!Model.Envio.Actual_EsReenvio)
                                {
                                    @if (Model.Envio.Actual_UsuarioLee_Tipo == ConstTipoDestinatario.TipoDestinatarioN1)
                                    {
                                        <a asp-area="Identity" asp-page="/Correspondencia/Lectura" asp-route-id="@Model.Envio.Origen_EnvioId" asp-route-tipo="@Model.Envio.Origen_TipoEnvioId" class="md-btn md-btn-raised md-btn-ripple bg-secondary mr-1" title="Ver el documento al que se le da respuesta">Ver origen</a>
                                    }

                                    <a asp-area="Identity" asp-page="/Correspondencia/Reenviar" asp-route-id="@Model.Envio.Actual_EnvioId" asp-route-tipo="@Model.Envio.Actual_Visualizacion_Tipo" class="md-btn md-btn-raised md-btn-ripple  mr-1" title="Turnar el documento actual">Turnar</a>
                                }
                            }
                        }
                    </li>

                </ol>
                @if (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Recepcion)
                {
                    if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                    {
                        if (!Model.EstaFechaCambiada && !Model.Envio.Actual_TieneRespuesta)
                        {
                            <ol class="breadcrumb-2 mt-0 mb-0 display-inline">
                                <li class="flex-right">
                                    <small><b class="font-blue"><i class="fas fa-exclamation-circle font-red"></i> Para Turnar este documento primero debe cambiar la fecha compromiso.</b></small>
                                </li>
                            </ol>
                        }
                    }
                }
                <hr class="hr-thick mt-2 mb-2" />
                <div class="mt-0 mb-0">
                    <div class="form-group row font-dark-gray">
                        <!-- Asunto -->
                        <div class="col-sm-12">
                            <div class="pb-2">
                                <b class="font-regular-13">@Model.Envio.Actual_AsuntoEnvio </b>
                            </div>
                        </div>
                    </div>
                    <div>
                        <span class="d-none" id="envio_identifica">@Model.Envio.Actual_EnvioId</span>
                        <span class="d-none" id="tipo_visualizacion">@Model.Envio.Actual_Visualizacion_Tipo</span>
                        <span class="d-none" id="tipo_envio">@Model.Envio.Actual_TipoEnvioId</span>
                        <span class="d-none" id="es_turnado">@Model.Envio.Actual_EsTurnado</span>
                        <span class="d-none" id="es_reenvio">@Model.Envio.Actual_EsReenvio</span>
                        <span class="d-none" id="existe_adjuntos">@Model.Envio.Actual_ExisteAdjuntos</span>
                        <span class="d-none" id="tiene_respuesta">@Model.Envio.Actual_TieneRespuesta</span>
                        <span class="d-none" id="fecha_propuesta">@Model.Envio.Actual_FechaPropuesta</span>
                        <!-- Origen -->
                        <span class="d-none" id="origen_envio_identifica">@Model.Envio.Origen_EnvioId</span>
                        <span class="d-none" id="origen_tipo_envio">@Model.Envio.Origen_TipoEnvioId</span>
                        <span class="d-none" id="origen_existe_adjuntos">@Model.Envio.Origen_ExisteAdjuntos</span>

                    </div>
                    <div class="form-group row font-dark-gray mb-0">
                        <div class="col-sm-12">
                            <!-- Remitente -->
                            <label for="inputEmail"><b>De: </b></label>
                            <label id="labelfrom" data-toggle="tooltip" data-placement="top" title="@Model.Envio.Actual_UsuarioDe_Correo">
                                @Model.Envio.Actual_UsuarioDe_NombreCompleto
                            </label>
                            <hr class="mt-0 mb-1" />
                        </div>
                    </div>
                    <div class="form-group row font-dark-gray mb-1">
                        <div class="col-sm-12">
                            <!-- Para / Destinatario-->
                            <label for="inputEmail"><b>Para: </b></label>
                            <label class="display-inline-flex" id="containerMailsFor">@Model.Envio.Actual_UsuariosPara</label>
                            <hr class="mt-0 mb-1" />
                        </div>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.Envio.Actual_UsuariosCCP))
                    {
                        <div class="form-group row font-dark-gray mb-1">
                            <div class="col-sm-12">
                                <!-- CC: -->
                            <label><b>CC: </b></label>
                                <label class="display-inline-flex" id="containerCCFor">@Model.Envio.Actual_UsuariosCCP</label>
                                <hr class="mt-0 mb-1" />
                            </div>
                        </div>
                    }

                    @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && (Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 || Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN2) && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                    {
                        @if (Model.Envio.Actual_ExisteAdjuntos)
                        {
                            <div class="form-group row font-dark-gray">
                                <div class="col-sm-12">
                                    <!-- Adjunto-->
                                    <label for="files" id="filesContainer"><b>Anexos: </b></label>
                                    <hr class="mt-0 mb-1" />
                                </div>
                            </div>
                            <div class="form-group row font-dark-gray mt-0 mb-1">
                                <div id="containerArchivos" class="ml-3"></div>
                            </div>
                        }
                        else
                        {
                            <div class="form-group row font-dark-gray">
                                <div class="col-sm-12">
                                    <!-- Adjunto-->
                                    <label for="files" id="filesContainer"><b>Anexos: </b></label>
                                    <hr class="mt-0 mb-1" />
                                </div>
                            </div>
                            <div class="form-group row font-dark-gray mt-0 mb-1">
                                @if((Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 && !Model.Envio.Actual_SupleTurnado && !Model.Envio.Actual_EsReenvio) || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN4 )
                                {
                                    <small class="font-dark-gray ml-3">Este documento no contiene archivos adjuntos</small>
                                    <br />
                                }
                                else if(Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN2 || (Model.Envio.Actual_TipoEnvio == ConstTipoEnvio.TipoEnvioT1 && Model.Envio.Actual_SupleTurnado))
                                {
                                    <small class="font-dark-gray ml-3">Este documento turnado no contiene archivos adjuntos</small>
                                    <br />
                                }
                                else if(Model.Envio.Actual_EsReenvio && Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 && !Model.Envio.Actual_SupleTurnado)
                                {
                                    <small class="font-dark-gray ml-3">Este documento reenviado no contiene archivos adjuntos</small>
                                    <br />
                                }
                            </div>
                        }

                        <!-- Solicitado respuesta-->
                        @if (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN2)
                        {
                            <div class="form-group row font-dark-gray mb-1">
                                <div class="col-xs-12 col-sm-7 col-md-7 col-lg-8 col-xl-8">
                                    @if (Model.Envio.Actual_RequiereRespuesta)
                                    {
                                        <small><b class="font-blue"><i class="fas fa-reply"></i> Req. Respuesta:</b> El remitente <b>SI</b> ha solicitado una respuesta.</small>
                                    }
                                    else
                                    {
                                        <small><b class="font-blue"><i class="fas fa-reply"></i> Req. Respuesta:</b> El remitente <b>NO</b> ha solicitado una respuesta.</small>
                                    }
                                    @if (!string.IsNullOrEmpty(Model.Envio.Actual_Tramite))
                                    {
                                        <br />
                                        <small title="Trámite"><b class="font-dark-gray"><i class="fab fa-buffer"></i> Trámite:</b> @Model.Envio.Actual_Tramite</small>
                                    }

                                    @if (!string.IsNullOrEmpty(Model.Envio.Actual_Importancia))
                                    {
                                        <br />
                                        <small title="Importancia"><b class="font-dark-gray"><i class="fas fa-exclamation-circle"></i> Importancia:</b> @Model.Envio.Actual_Importancia</small>
                                    }

                                    @if (!string.IsNullOrEmpty(Model.Envio.Actual_Visibilidad))
                                    {
                                        <br />
                                        <small title="Visibilidad"><b class="font-dark-gray"><i class="fas fa-eye"></i> Visibilidad:</b> @Model.Envio.Actual_Visibilidad</small>
                                    }
                                </div>
                                <div class="col-xs-12 col-sm-5 col-md-5 col-lg-4 col-xl-4">
                                    @if (Model.Envio.Actual_RequiereRespuesta && (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Recepcion))
                                    {
                                        @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1))
                                        {
                                            @if (Model.Envio.Actual_TieneRespuesta)
                                            {
                                                <small title="Fecha compromiso">
                                                    <b class="font-green"><i class="fa fa-calendar" aria-hidden="true"></i> Fecha compromiso: </b>
                                                    <span>@Model.Envio.Actual_FechaCompromiso</span>
                                                </small>
                                                <br />
                                            }
                                            else
                                            {
                                                @if (Model.NuevoCompromiso.TipoEnvioId == ConstTipoEnvio.TipoEnvioN1)
                                                {
                                                    <small title="@string.Format("{0}", Model.EstaFechaCambiada? "Fecha compromiso" : "No se puede turnar hasta que se registre una fecha compromiso")">
                                                        <b class="@string.Format("{0}", Model.EstaFechaCambiada? "font-green" : "font-red")"><i class="fa fa-calendar" aria-hidden="true"></i> Fecha compromiso: </b>
                                                        <span id="fechaCompromisoActual">@Model.Envio.Actual_FechaCompromiso</span>
                                                    </small>

                                                    <!-- Button trigger modal -->
                                                    <button id="btn-compromiso" type="button" class="btn btn-link m-0 p-0" data-toggle="modal" data-target="#compromisoModal">
                                                        <small class="font-red">Cambiar</small>
                                                    </button>

                                                    <!-- Modal -->

                                                    <div class="modal fade" id="compromisoModal" tabindex="-1" role="dialog" aria-labelledby="compromisoModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                                            <div class="modal-content">
                                                                <form method="post" asp-page-handler="">
                                                                    <div class="modal-header">
                                                                        <h3 class="modal-title" id="compromisoModalLabel">Establecer fecha compromiso</h3>
                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div asp-validation-summary="ModelOnly" class="text-danger error-list-clean"></div>
                                                                        <input class="sin-indicador" asp-for="NuevoCompromiso.EnvioId" />
                                                                        <input class="sin-indicador" asp-for="NuevoCompromiso.TipoEnvioId" />
                                                                        <input class="sin-indicador" asp-for="NuevoCompromiso.RecepcionId" />

                                                                        <div class="form-group">
                                                                            <label>Fecha recepción</label>
                                                                            <div class="">
                                                                                <p class="small">@Model.Envio.Origen_Fecha</p>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label asp-for="NuevoCompromiso.TramiteId"></label>
                                                                            <div class="">
                                                                                <select asp-for="NuevoCompromiso.TramiteId" class="sin-indicador selectpicker show-tick" data-live-search="true" data-none-results-text="Ningún resultado coincide con {0}" data-style="" data-width="auto">

                                                                                    @foreach (var tramite in Model.Tramites)
                                                                                    {
                                                                                        if (tramite.Nombre == ConstTramite.TipoT1)
                                                                                        {
                                                                                            <option value="@tramite.TramiteId" data-tdias="@tramite.Dias" selected>@tramite.Nombre</option>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <option value="@tramite.TramiteId" data-tdias="@tramite.Dias">@tramite.Nombre</option>
                                                                                        }
                                                                                    }

                                                                                </select>
                                                                                <span asp-validation-for="NuevoCompromiso.TramiteId" class="text-danger"></span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label asp-for="NuevoCompromiso.FechaCompromiso"></label>
                                                                            <div class="">
                                                                                <input asp-for="NuevoCompromiso.FechaCompromiso" class="form-control bg-white form-control-sm form-control-x d-inline-block" aria-describedby="FechaCompromiso" placeholder="Seleccione una fecha">
                                                                                <span asp-validation-for="NuevoCompromiso.FechaCompromiso" class="text-danger"></span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label asp-for="NuevoCompromiso.Motivo"></label>
                                                                            <div class="">
                                                                                <textarea asp-for="NuevoCompromiso.Motivo" class="form-control" placeholder="Motivo del cambio de fecha" rows="4"></textarea>
                                                                                <span asp-validation-for="NuevoCompromiso.Motivo" class="text-danger"></span>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancelar</button>
                                                                        <button type="submit" asp-page-handler="compromiso" class="btn btn-primary btn-sm">Cambiar</button>
                                                                        <!--Para que el  boton tipo submit sepa que "OnPost" deba tener se le debe agregar el atributo asp-page-handler el mismo nombre que se concatena al post-->
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    @if (!Model.EstaFechaCambiada)
                                                    {
                                                        <div>
                                                            <form method="post" asp-page-handler="">
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.EnvioId" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.TipoEnvioId" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.RecepcionId" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.TramiteId" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.Motivo" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.FechaCompromiso" />
                                                                <!--Aceptar fecha compromiso-->
                                                                <button id="btn-aceptar-compromiso" type="submit" asp-page-handler="aceptar" class="btn bg-secondary btn-sm">
                                                                    Aceptar fecha compromiso
                                                                </button>
                                                            </form>
                                                        </div>
                                                    }
                                                    <br />
                                                }
                                                else if (Model.NuevoCompromiso.TipoEnvioId == ConstTipoEnvio.TipoEnvioN2)
                                                {
                                                    <small title="Fecha compromiso">
                                                        <b class="@string.Format("{0}", Model.EstaFechaCambiada? "font-green" : "font-red")"><i class="fa fa-calendar" aria-hidden="true"></i> Fecha compromiso: </b>
                                                        <span id="fechaCompromisoActual">@Model.Envio.Actual_FechaCompromiso</span>
                                                    </small>

                                                    <input asp-for="Inhabiles.Dias" class="sin-indicador" />
                                                    <input asp-for="Inhabiles.Inicio" class="sin-indicador" />
                                                    <input asp-for="Inhabiles.Limite" class="sin-indicador" />

                                                    <!-- Button trigger modal -->
                                                    <button id="btn-compromiso" type="button" class="btn btn-link m-0 p-0" data-toggle="modal" data-target="#compromisoModal">
                                                        <small class="font-red">Cambiar</small>
                                                    </button>

                                                    <br />

                                                    <!-- Modal -->
                                                    <div class="modal fade" id="compromisoModal" tabindex="-1" role="dialog" aria-labelledby="compromisoModalLabel" aria-hidden="true">
                                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                                            <div class="modal-content">
                                                                <form method="post" asp-page-handler="">
                                                                    <div class="modal-header">
                                                                        <h3 class="modal-title" id="compromisoModalLabel">Establecer fecha compromiso</h3>
                                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                            <span aria-hidden="true">&times;</span>
                                                                        </button>
                                                                    </div>
                                                                    <div class="modal-body">
                                                                        <div asp-validation-summary="ModelOnly" class="text-danger error-list-clean"></div>
                                                                        <input class="sin-indicador" asp-for="NuevoCompromiso.EnvioId" />
                                                                        <input class="sin-indicador" asp-for="NuevoCompromiso.TipoEnvioId" />
                                                                        <input class="sin-indicador" asp-for="NuevoCompromiso.RecepcionId" />
                                                                        <input class="sin-indicador d-none" asp-for="NuevoCompromiso.TramiteId" />

                                                                        <div class="form-group">
                                                                            <label asp-for="NuevoCompromiso.FechaCompromiso"></label>
                                                                            <div class="">
                                                                                <input asp-for="NuevoCompromiso.FechaCompromiso" class="form-control bg-white form-control-sm form-control-x d-inline-block" aria-describedby="FechaCompromiso" placeholder="Seleccione una fecha">
                                                                                <span asp-validation-for="NuevoCompromiso.FechaCompromiso" class="text-danger"></span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="form-group">
                                                                            <label asp-for="NuevoCompromiso.Motivo"></label>
                                                                            <div class="">
                                                                                <textarea asp-for="NuevoCompromiso.Motivo" class="form-control" placeholder="Motivo del cambio de fecha" rows="4"></textarea>
                                                                                <span asp-validation-for="NuevoCompromiso.Motivo" class="text-danger"></span>
                                                                            </div>
                                                                        </div>

                                                                    </div>
                                                                    <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cancelar</button>
                                                                        <button type="submit" asp-page-handler="compromiso" class="btn btn-primary btn-sm">Cambiar</button>
                                                                    </div>
                                                                </form>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    @if (!Model.EstaFechaCambiada)
                                                    {
                                                        <div>
                                                            <form method="post" asp-page-handler="">
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.EnvioId" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.TipoEnvioId" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.RecepcionId" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.TramiteId" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.Motivo" />
                                                                <input class="sin-indicador" asp-for="CompromisoAceptado.FechaCompromiso" />
                                                                <!--Aceptar fecha compromiso-->
                                                                <button id="btn-aceptar-compromiso" type="submit" asp-page-handler="aceptar" class="btn bg-secondary btn-sm">
                                                                    Aceptar fecha compromiso
                                                                </button>
                                                            </form>
                                                        </div>
                                                    }
                                                }
                                                <!---->
                                                <input class="sin-indicador" asp-for="Numerologia.TotalTurnados" />
                                                <input class="sin-indicador" asp-for="EstaFechaCambiada" />
                                            }
                                        }
                                        else
                                        {
                                            <small title="Fecha compromiso">
                                                <b class="font-green"><i class="fa fa-calendar" aria-hidden="true"></i> Fecha compromiso: </b>
                                                <span>@Model.Envio.Actual_FechaCompromiso</span>
                                            </small>
                                            <br />
                                        }
                                    }
                                    else if (Model.Envio.Actual_RequiereRespuesta && Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Envio)
                                    {
                                        <small title="Fecha propuesta"><b class="font-green"><i class="fa fa-calendar" aria-hidden="true"></i> Fecha propuesta: </b>@Model.Envio.Actual_FechaPropuesta</small><br />
                                    }
                                    <small title="Estado"><b class="font-dark-gray"><i class="far fa-flag"></i> Estado:</b> @Model.Envio.Actual_Estado</small><br />

                                    @if (!string.IsNullOrEmpty(Model.Envio.Origen_TipoDocumento))
                                    {
                                        <small title="Tipo de documento"><b class="font-dark-gray"><i class="fas fa-file"></i> Tipo de documento:</b> @Model.Envio.Origen_TipoDocumento</small>
                                    }

                                    @if (!string.IsNullOrEmpty(Model.Envio.Actual_TipoEnvio))
                                    {
                                        <br />
                                        if (Model.Envio.Actual_TipoEnvio == ConstTipoEnvio.TipoEnvioT1 && Model.Envio.Actual_SupleTurnado)
                                        {
                                            <small title="Tipo de envío"><b class="font-dark-gray"><i class="fas fa-share-square"></i> Tipo de envío:</b> Turnado </small>
                                        }
                                        else
                                        {
                                            <small title="Tipo de envío"><b class="font-dark-gray"><i class="fas fa-share-square"></i> Tipo de envío:</b> @string.Format("{0} {1}", Model.Envio.Actual_TipoEnvio, Model.Envio.Actual_EsReenvio ? "(Reenvío)" : "") </small>
                                        }
                                    }
                                </div>
                            </div>
                        }
                        else if (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN3 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN4)
                        {
                            <div class="form-group row font-dark-gray mb-1">
                                <div class="col-xs-12 col-sm-7 col-md-7 col-lg-8 col-xl-8">
                                    @if (!string.IsNullOrEmpty(Model.Envio.Actual_Visibilidad))
                                    {
                                        <small title="Visibilidad"><b class="font-dark-gray"><i class="fas fa-eye"></i> Visibilidad:</b> @Model.Envio.Actual_Visibilidad</small>
                                    }
                                </div>
                                <div class="col-xs-12 col-sm-5 col-md-5 col-lg-4 col-xl-4">

                                    <small title="Estado"><b class="font-dark-gray"><i class="far fa-flag"></i> Estado:</b> @Model.Envio.Actual_Estado</small>

                                    @if (!string.IsNullOrEmpty(Model.Envio.Origen_TipoDocumento))
                                    {
                                        <br />
                                        <small title="Tipo de documento"><b class="font-dark-gray"><i class="fas fa-file"></i> Tipo de documento:</b> @Model.Envio.Origen_TipoDocumento</small>
                                    }
                                    @if (!string.IsNullOrEmpty(Model.Envio.Actual_TipoEnvio))
                                    {
                                        <br />
                                        if (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN4 && Model.Envio.Actual_EsReenvio)
                                        {
                                            <small title="Tipo de envío"><b class="font-dark-gray"><i class="fas fa-share-square"></i> Tipo de envío:</b> Turnado </small>
                                        }
                                        else
                                        {
                                            <small title="Tipo de envio"><b class="font-dark-gray"><i class="fas fa-share-square"></i> Tipo de envío:</b> @string.Format("{0} {1}", Model.Envio.Actual_TipoEnvio, Model.Envio.Actual_EsReenvio ? "(Reenvío)" : "") </small>
                                        }
                                    }
                                </div>
                            </div>
                        }

                        @if (Model.Envio.Actual_EsTurnado || Model.Envio.Actual_EsReenvio)
                        {
                            <div class="form-group row font-dark-gray mb-1">
                                <div class="col-12 font-regular-13 text-justify">
                                    @*<small title="Indicaciones"><b class="font-dark-gray"> Indicaciones:</b> @Model.Envio.Actual_Indicaciones</small>*@
                                    <div class="card border-gray-card-1">
                                        <div class="card-header p-0 text-center font-bold-11 bg-gray-card-1 mensaje-datos">
                                            Mensaje de texto
                                        </div>
                                        <div class="card-body pt-1 mb-1">
                                            <p class="card-text font-regular-11 text-justify">@Html.Raw(Model.Envio.Actual_Indicaciones)</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="pt-3">
                                <hr class="double mt-0 mb-1 pt-1" />
                            </div>
                        }
                        else if (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1)
                        {
                            if (!String.IsNullOrEmpty(Model.Envio.Actual_Indicaciones))
                            {
                                <div class="form-group row font-dark-gray mb-1">
                                    <div class="col-12 font-regular-13 text-justify">
                                        @*<small title="Indicaciones"><b class="font-dark-gray"> Indicaciones:</b> @Model.Envio.Actual_Indicaciones</small>*@
                                        <div class="card border-gray-card-1">
                                            <div class="card-header p-0 text-center font-bold-11 bg-gray-card-1 mensaje-datos">
                                                Mensaje de texto
                                            </div>
                                            <div class="card-body pt-1 mb-1">
                                                <p class="card-text font-regular-11 text-justify">@Html.Raw(Model.Envio.Actual_Indicaciones)</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="pt-3">
                                    <hr class="double mt-0 mb-1 pt-1" />
                                </div>
                            }
                        }

                        @if ((Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Envio || Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Recepcion) && (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN2 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN3 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN4))
                        {
                            if (Model.Envio.Origen_UsuarioCreador != Model.Envio.Origen_UsuarioTitular)
                            {
                                <div class="form-group row font-dark-gray mb-1">
                                    <div class="col-12">
                                        <small title="Usuario creador"><b class="font-dark-gray"><i class="fas fa-user-friends"></i></b> Documento enviado por <b>@Model.Envio.Origen_NombreCreador (@Model.Envio.Origen_UsuarioCreador)</b> en nombre de <b>@Model.Envio.Origen_NombreTitular (@Model.Envio.Origen_UsuarioTitular)</b>.</small>
                                    </div>
                                </div>
                            }
                        }

                        @if (Model.Envio.Actual_EsTurnado || (Model.Envio.Actual_SupleTurnado && Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1) || (Model.Envio.Actual_EsReenvio && Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1))
                        {
                            if(Model.Envio.Origen_ExisteAdjuntos)
                            {
                                <div class="form-group row font-dark-gray mt-2">
                                    <div class="col-sm-12">
                                        <!-- Adjunto-->
                                        <label><b>Anexos originales: </b></label>
                                        <hr class="mt-0 mb-1" />
                                    </div>
                                </div>
                                <div class="form-group row font-dark-gray mt-0 mb-1">
                                    <div id="containerArchivosOrigen" class="ml-3"></div>
                                </div>
                            }
                            else
                            {
                                <div class="form-group row font-dark-gray mt-2">
                                    <div class="col-sm-12">
                                        <!-- Adjunto-->
                                <label><b>Anexos originales: </b></label>
                                        <hr class="mt-0 mb-1" />
                                    </div>
                                </div>
                                <div class="form-group row font-dark-gray mt-0 mb-1">
                                    <small class="font-dark-gray ml-3">Este documento no contiene archivos adjuntos</small>
                                    <br />
                                </div>
                            }
                            
                        }
                        
                        <div class="form-group row font-dark-gray">
                            <div class="col-sm-12">
                                <!-- Folio -->
                            <div class="mt-1">
                                    <b class="font-regular-12">Folio: <span id="folioInput">@Model.Envio.Origen_Folio</span></b>
                                </div>
                            </div>
                        </div>

                        <!--PLANTILLA PARA EL DOCUMENTO-->
                        <div class="" id="documento">
                            @*@if (Model.Envio.Actual_EsTurnado)
                                {
                                <div class="card-body p-0 pt-1" id="docTurnado">
                                <div class="card">
                                <div class="card-header font-dark-gray p-1 text-center">
                                Documento turnado
                                </div>
                                <div class="card-body p-2">
                                <p class="card-text text-justify font-dark-gray">@Model.Envio.Actual_Indicaciones</p>
                                </div>
                                @if (Model.Envio.Actual_ExisteAdjuntos)
                                {
                                <div class="card-footer text-justify text-muted p-1" id="contenedorArchivosTurnar"></div>
                                }
                                </div>
                                </div>
                                }*@

                            <div class="card-body p-0 pt-1" id="docContenido">
                                <div class="row pt-0 mb-3">
                                    <div class="col-sm-12 col-xl-12">
                                        <div class="col align-text-right" id="docEncabezado">
                                            @*<img id="logoInstitucion" class="logo-simbolo" src="~/images/LIS_UV_COLOR_3.png" />*@
                                            <cache enabled="true" expires-after="@TimeSpan.FromSeconds(5)">
                                                <img id="logoInstitucion" class="logo-simbolo" src="@Url.Action("Logo", "Anexos", new { id = Model.Envio.Origen_UsuarioDe_AreaId })" />
                                            </cache>
                                            <p id="docAreaSuperior" class="m-0 font-bold-11">@Model.Envio.Origen_UsuarioDe_AreaPadreNombre</p>
                                            <p id="docArea" class="m-0 font-regular-10 mb-2">@Model.Envio.Origen_UsuarioDe_AreaNombre</p>

                                            <p id="docRegion" class="m-0 font-bold-10 mb-2">Región @Model.Envio.Origen_UsuarioDe_Region</p>

                                            <p id="docAsunto" class="m-0 font-regular-10">@Model.Envio.Origen_Asunto</p>
                                            @if (!string.IsNullOrEmpty(Model.Envio.Origen_NoInterno))
                                            {
                                                <p id="docNumOficio" class="m-0 font-regular-10"><span>OF. No. </span>@Model.Envio.Origen_NoInterno</p>
                                            }
                                            <p id="docFecha" class="m-0 font-regular-10">@Model.Envio.Origen_Fecha</p>
                                        </div>
                                    </div>
                                </div>

                                @if ((Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 && Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Recepcion) ||
                               (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN2) ||
                               (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN3) ||
                               (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN4))
                                {
                                    if (Model.Envio.Origen_UsuarioPara_Tipo == ConstTipoDestinatario.TipoDestinatarioN2)
                                    {
                                        <div class="row pt-1 pb-3">
                                            <div class="col-sm-3 col-md-3 col-lg-3 col-xl-2"></div>
                                            <div class="col-sm-9 col-md-9 col-lg-9 col-xl-10">
                                                <div class="float-left" id="docInfo">
                                                    <p id="docParaNombre" class="m-0 font-bold-11" style="white-space: pre-line">@Html.Raw(System.Web.HttpUtility.HtmlDecode(Model.Envio.Actual_UsuariosPara.Replace(",", "<br>").ToUpper()))</p>
                                                    <p id="docParaInstitucion" class="m-0 font-regular-10">UNIVERSIDAD VERACRUZANA</p>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="row pt-1 pb-3">
                                            <div class="col-sm-3 col-md-3 col-lg-3 col-xl-2"></div>
                                            <div class="col-sm-9 col-md-9 col-lg-9 col-xl-10">
                                                <div class="float-left" id="docInfo">
                                                    <p id="docParaNombre" class="m-0 font-bold-11">@Model.Envio.Origen_UsuarioPara_NombreCompleto</p>
                                                    <p id="docParaPuesto" class="m-0 font-bold-10">@Model.Envio.Origen_UsuarioPara_PuestoNombre</p>
                                                    <p id="docParaArea" class="m-0 font-bold-10">@Model.Envio.Origen_UsuarioPara_AreaNombre</p>
                                                    <p id="docParaInstitucion" class="m-0 font-bold-11">UNIVERSIDAD VERACRUZANA</p>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                                <div class="row pt-0">
                                    <div class="col-sm-3 col-md-3 col-lg-3 col-xl-2 align-text-right pt-5" id="docLado">
                                        <div class="mb-4">
                                            <p class="font-regular-9 mb-0">Dirección</p>
                                            <p id="docDeDireccion" class="font-regular-9 mb-0">@Model.Envio.Origen_UsuarioDe_Direccion</p>
                                        </div>
                                        <div class="mb-4">
                                            <p class="font-regular-9 mb-0">Teléfono(s)</p>
                                            <p id="docDeTelefono" class="font-regular-9 mb-0">@Model.Envio.Origen_UsuarioDe_Telefono</p>
                                        </div>
                                        <div class="mb-4">
                                            <p class="font-regular-9 mb-0">Correo electrónico</p>
                                            <p id="docDeCorreo" class="font-regular-9 mb-0">@Model.Envio.Origen_UsuarioDe_Correo</p>
                                        </div>
                                    </div>
                                    <div class="col-sm-9 col-md-9 col-lg-9 col-xl-10  gray-theme" id="docCuerpo">
                                        <div class="text-justify font-regular-12 fr-view">@Html.Raw(Model.Envio.Origen_Cuerpo)</div>
                                        <div class="pt-5" id="docFirma">
                                            <p class="mt-2 mb-0 font-regular-12">A t e n t a m e n t e</p>
                                            <p id="docFirmaInstitucion" class="font-weight-light font-regular-12">"Lis de Veracruz: Arte, Ciencia, Luz"</p>
                                            <br />
                                            <p id="docDeNombre" class="mb-0 font-regular-12">@Model.Envio.Origen_UsuarioDe_NombreCompleto</p>
                                            <p id="docDePuesto" class="mb-0 font-regular-10">@Model.Envio.Origen_UsuarioDe_PuestoNombre</p>
                                            <p id="docDeArea" class="mb-0 font-regular-10">@Model.Envio.Origen_UsuarioDe_AreaNombre</p>
                                            <p id="docDeInstitucion" class="mb-0 font-regular-11">Universidad Veracruzana</p>
                                        </div>
                                        <div class="pt-5" id="ccpContainer">
                                            @foreach (var ccp in Model.Envio.Origen_ListadoCcp)
                                            {
                                                <p class="mb-0 font-regular-8">
                                                    C.c.p. <span>@ccp </span>
                                                    @*@if (Model.Envio.Origen_UsuarioPara_Tipo == ConstTipoDestinatario.TipoDestinatarioN2)
                                                        {
                                                        <span> - Para su conocimiento</span>
                                                        }*@
                                                </p>
                                            }
                                        </div>
                                    </div>
                                </div>
                            </div>
                            @if (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Recepcion)
                            {
                                <div class="card-footer p-1 text-center bg-white mt-2 border-bottom leyenda-recibidos">
                                    <p id="docRecibido" class="m-0">RECIBIDO - @Model.Envio.Actual_Fecha Hrs.</p>
                                </div>
                            }
                            <div class="text-center d-none" id="docQr">
                                <!--d-none para que esté cargada pero no se muestre. Se presume que es para la generación del pdf-->
                            <img class="imgen-qr" id="imagenQr" src="@string.Format("data:image/png;base64,{0}", Model.CodigoQR)" />
                            </div>
                        </div>
                    }
                    else
                    {
                        <div class="text-center font-regular-13">Usted no tiene permiso para visualizar el contenido de este oficio.</div>
                    }
                </div>
            </div>
            <div class="col-sm-12 col-md-3 col-lg-12 col-xl-2 right-sidebar" id="division-derecha">
                <form method="post" id="DescargaPDFForm">
                    @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && (Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 || Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN2) && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                    {
                        <div class="form-group" id="ButtonsOficio">
                            <button type="submit" download class="md-btn md-btn-raised md-btn-ripple bg-secondary"
                                id="savetest" asp-page-handler="base">
                                Descargar PDF
                            </button>
                            <input class="sin-indicador" asp-for="DescargaPDF.Folio" />
                            <input class="sin-indicador" asp-for="DescargaPDF.AreaSuperior" />
                            <input class="sin-indicador" asp-for="DescargaPDF.Area" />
                            <input class="sin-indicador" asp-for="DescargaPDF.Region" />
                            <input class="sin-indicador" asp-for="DescargaPDF.Asunto" />
                            <input class="sin-indicador" asp-for="DescargaPDF.NumeroInterno" />
                            <input class="sin-indicador" asp-for="DescargaPDF.Fecha" />
                            <input class="sin-indicador" asp-for="DescargaPDF.ParaNombre" />
                            <input class="sin-indicador" asp-for="DescargaPDF.ParaNombreEnviado" />
                            <input class="sin-indicador" asp-for="DescargaPDF.ParaPuesto" />
                            <input class="sin-indicador" asp-for="DescargaPDF.ParaArea" />
                            <input class="sin-indicador" asp-for="DescargaPDF.DeDireccion" />
                            <input class="sin-indicador" asp-for="DescargaPDF.DeTelefono" />
                            <input class="sin-indicador" asp-for="DescargaPDF.DeCorreo" />
                            <input class="sin-indicador" asp-for="DescargaPDF.Cuerpo" />
                            <input class="sin-indicador" asp-for="DescargaPDF.DeNombre" />
                            <input class="sin-indicador" asp-for="DescargaPDF.DePuesto" />
                            <input class="sin-indicador" asp-for="DescargaPDF.DeArea" />
                            <input class="sin-indicador" asp-for="DescargaPDF.TipoUsuario" />
                            <input class="sim-indicador" asp-for="DescargaPDF.UsuariosParaCC" />
                            @for (int i = 0; i < Model.DescargaPDF.CCP.Count; i++)
                            {
                                @Html.HiddenFor(ccp => ccp.DescargaPDF.CCP[i])
                            }
                            <input class="sin-indicador" asp-for="DescargaPDF.LeyendaRecibido" />
                            <input class="sin-indicador" asp-for="DescargaPDF.CodigoQR" />
                            <input class="sin-indicador" asp-for="DescargaPDF.Indicaciones" />
                            <input class="sin-indicador" asp-for="DescargaPDF.UsuariosDeActual" />
                            <input class="sin-indicador" asp-for="DescargaPDF.UsuariosParaActual" />
                            <input class="sin-indicador" asp-for="DescargaPDF.UsuariosParaCCActual" />
                            <input class="sin-indicador" asp-for="DescargaPDF.FechaRecepcion" />
                            <input class="sin-indicador" asp-for="DescargaPDF.FechaCompromiso" />
                            <hr class="mt-2 mb-2" />
                        </div>
                    }
                </form>
                @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && (Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 || Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN2) && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                {
                    <div class="form-group mt-3">
                        <a asp-area="Identity" asp-page="/Correspondencia/Seguimiento" asp-route-id="@Model.Envio.Actual_EnvioId" asp-route-tipo="@Model.Envio.Actual_TipoEnvioId" class="md-btn md-btn-raised md-btn-ripple bg-secondary">Ver seguimiento</a>
                        <hr class="mt-2 mb-2" />
                    </div>
                }
                @if (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Envio)
                {
                    @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                    {
                        <div>
                            <!--Tags / Categorías-->
                    <label for="asunto" class="col-form-label">Categorías:</label>
                            @*<hr class="mt-0 mb-2" />*@
                            <div class="align-text-left" id="tagsSaver"></div>
                        </div>
                        <br />
                    }
                }
                else if (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Recepcion)
                {
                    <div>
                        <!--Tags / Categorías-->
                        @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                        {
                            <label for="asunto" class="col-form-label">Categorías:</label>
                            @*<hr class="mt-0 mb-2" />*@
                            <div class="align-text-left" id="tagsSaver"></div>
                            <span class="text-danger d-none small" id="txtAviso"></span>
                        }

                        @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                        {
                            <button type="button" class="md-btn md-btn-raised md-btn-ripple bg-secondary mt-2" id="buttonCategoria">Agregar categoría</button>
                        }
                        <span class="d-none" id="catSeleccionadas"></span>
                        <hr />
                        @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                        {
                            <button type="button" class="md-btn md-btn-raised md-btn-ripple bg-secondary mt-2" id="buttonActualizar" title="Actualizar las categorías del documento">Guardar</button>
                        }
                        <hr />
                        @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                        {
                            <button type="button" class="md-btn md-btn-raised md-btn-ripple mt-2" data-toggle="modal" data-target="#ModalCorreo" data-whatever="uv.mx">Enviar por correo</button>
                        }
                    </div>
                    <br />
                }
                @if (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Envio && (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN1 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN2))
                {
                    if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && (Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 || Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN2) && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                    {
                        <div id="contenedor-destiantarios">
                            <label class="col-form-label">Destinatarios:</label>
                            <hr class="mt-0 mb-2" />
                            <div class="align-text-left">
                                @foreach (var destinatario in Model.ResumenDestinatarios)
                                {
                                    <div>
                                        <vc:estado-envio estado="destinatario.EstadoEnvioId"></vc:estado-envio>
                                        @if (destinatario.EstaLeido)
                                        {
                                            <span class="font-dark-gray"><i title="Leído" class="far fa-envelope-open"></i></span>
                                        }
                                        else
                                        {
                                            <span class="font-dark-gray"><i title="Sin leer" class="far fa-envelope"></i></span>
                                        }

                                        @if (destinatario.TieneRespuesta)
                                        {
                                            <a asp-area="Identity" asp-page="/Correspondencia/Visualizacion" asp-route-id="@destinatario.EnvioId" asp-route-tipo="@destinatario.TipoEnvioId" asp-route-usuario="@Model.Envio.Actual_UsuarioDe_NombreUsuario" class="font-regular-9" title="@destinatario.NombreCompleto respondió el @destinatario.FechaRespuesta">@destinatario.NombreCompleto</a>
                                        }
                                        else
                                        {
                                            <span class="font-regular-9">@destinatario.NombreCompleto</span>
                                        }

                                        @if (destinatario.RequiereRespuesta)
                                        {
                                            <div class="accordion" id="@string.Format("detalleCompromiso{0}", destinatario.RecepcionId)">
                                                <div class="card border-0">
                                                    <div class="card-header p-0 bg-white border-0" id="@string.Format("encabezadoCompromiso{0}", destinatario.RecepcionId)">
                                                        <button class="btn btn-link collapsed font-regular-8 pl-2 pr-0 pt-0 pb-0" type="button" data-toggle="collapse" data-target="@string.Format("#collapseCompromiso{0}", destinatario.RecepcionId)" aria-expanded="true" aria-controls="@string.Format("collapseCompromiso{0}", destinatario.RecepcionId)">
                                                            <span class="font-dark-gray" title="Detalle de la fecha compromiso">
                                                                @if (destinatario.ConFechaCompromiso)
                                                                {
                                                                    <b class="font-green"><i class="far fa-calendar-check"></i> Fecha compromiso: </b>
                                                                }
                                                                else
                                                                {
                                                                    <b class="font-green"><i class="far fa-calendar"></i> Fecha compromiso: </b>
                                                                }

                                                                @destinatario.FechaCompromiso
                                                            </span>
                                                        </button>
                                                    </div>
                                                    <div id="@string.Format("collapseCompromiso{0}", destinatario.RecepcionId)" class="collapse" aria-labelledby="@string.Format("encabezadoCompromiso{0}", destinatario.RecepcionId)" data-parent="@string.Format("#detalleCompromiso{0}", destinatario.RecepcionId)">
                                                        <div class="card-body pl-1 pr-0 pt-0 pb-0 border-0">
                                                            <ul class="list-unstyled m-0">
                                                                <li class="pl-1 font-regular-8 font-italic">
                                                                    <span class="" title="Fecha compromiso">@destinatario.FechaCompromisoActual.Fecha</span>
                                                                    <span class="" title="Fecha en la que se cambió la fecha compromiso"> (@destinatario.FechaCompromisoActual.Registro)</span>
                                                                    <p class="p-0 m-0">@destinatario.FechaCompromisoActual.Motivo</p>
                                                                </li>
                                                                <li class="pl-1 font-regular-8 text-right">

                                                                    <button type="button" class="btn btn-link m-0 p-0" data-toggle="modal" data-target="@string.Format("#compromisoHistorico{0}", destinatario.RecepcionId)">
                                                                        <small>Ver más</small>
                                                                    </button>

                                                                    <!-- Modal -->
                                                    <div class="modal fade" id="@string.Format("compromisoHistorico{0}", destinatario.RecepcionId)" tabindex="-1" role="dialog" aria-labelledby="@string.Format("compromisoHistoricoModal{0}Label", destinatario.RecepcionId)" aria-hidden="true">
                                                                        <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
                                                                            <div class="modal-content">
                                                                                <div class="modal-header">
                                                                                    <h5 class="modal-title font-bold-12" id="@string.Format("compromisoHistoricoModal{0}Label", destinatario.RecepcionId)">Historial de cambios (Fechas compromiso)</h5>
                                                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                                        <span aria-hidden="true">&times;</span>
                                                                                    </button>
                                                                                </div>
                                                                                <div class="modal-body text-justify">
                                                                                    <table class="table table-striped table-bordered table-sm ">
                                                                                        <thead>
                                                                                            <tr>
                                                                                                <th scope="col">Fecha compromiso</th>
                                                                                                <th scope="col">Motivo</th>
                                                                                            </tr>
                                                                                        </thead>
                                                                                        <tbody>
                                                                                            @foreach (var compromiso in destinatario.FechasCompromisoHistorico)
                                                                                            {
                                                                                                <tr class="font-regular-10 @string.Format("{0}", compromiso.Estado == ConstCompromiso.EstadoN1 ? "font-italic": "")">
                                                                                                    <td>@compromiso.Fecha (@compromiso.Registro)</td>
                                                                                                    <td>@compromiso.Motivo</td>
                                                                                                </tr>
                                                                                            }
                                                                                        </tbody>
                                                                                    </table>
                                                                                </div>
                                                                                <div class="modal-footer">
                                                                                    <button type="button" class="btn btn-secondary btn-sm" data-dismiss="modal">Cerrar</button>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                            </div>
                        </div>

                        <button type="button" class="md-btn md-btn-raised md-btn-ripple mt-2" data-toggle="modal" data-target="#ModalCorreo" data-whatever="uv.mx">Enviar por correo</button>
                    }
                }
                else if (Model.Envio.Actual_Visualizacion_Tipo == ConstVisualizacionEnvio.Envio && (Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN3 || Model.Envio.Actual_TipoEnvioId == ConstTipoEnvio.TipoEnvioN4))
                {
                    @if (!Model.InfoDelegar.EstaActiva || (Model.InfoDelegar.EstaActiva && (Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN1 || Model.InfoDelegar.TipoPermiso == ConstDelegar.TipoN2) && Model.Envio.Actual_Visibilidad != ConstVisibilidad.VisibilidadT2))
                    {
                        <div id="contenedor-destiantarios">
                            <label class="col-form-label">Destinatarios:</label>
                            <hr class="mt-0 mb-2" />
                            <div class="align-text-left">
                                @foreach (var destinatario in Model.ResumenDestinatarios)
                                {
                                    <vc:estado-envio estado="destinatario.EstadoEnvioId"></vc:estado-envio>

                                    if (destinatario.EstaLeido)
                                    {
                                        <span class="font-dark-gray"><i title="Leído" class="far fa-envelope-open"></i></span>
                                    }
                                    else
                                    {
                                        <span class="font-dark-gray"><i title="Sin leer" class="far fa-envelope"></i></span>
                                    }

                                    <span class="font-regular-9">@destinatario.NombreCompleto</span>
                                    <br />
                                }
                            </div>
                        </div>

                        <button type="button" class="md-btn md-btn-raised md-btn-ripple mt-2" data-toggle="modal" data-target="#ModalCorreo" data-whatever="uv.mx">Enviar por correo</button>
                    }
                }
            </div>
            <br />
        </div>
        <br />
    </div>
</div>

@section scripts
{
<partial name="_ValidationScriptsPartial" />
<script type="text/javascript" src="~/js/Areas/Identity/Pages/Correspondencia/Lectura.min.js" asp-append-version="true"></script>
    @*<script type="text/javascript" src="~/js/descargarDocumento.js" asp-append-version="true"></script>*@
    @*<script type="text/javascript" src="~/js/descargaPdf.js" asp-append-version="true"></script>*@
}
