function setupCategorias(){var t={urln:""},n;t.urln=objWebRoot.route+"api/v1/categorias/"+objUser.username;n=document.getElementById("categoriasSelect");$.ajax({url:t.urln,type:"GET",datatype:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(t){$.each(t,function(t,i){n.options[n.options.length]=new Option(i.Nombre,i.CategoriaId)})}})}function setupInitDataRecibidos(){var n=[],t=objWebRoot.route+"api/v1/estadisticas/recibidos/"+objUser.username;fetch(t,{headers:{Authorization:"Bearer "+objWebRoot.token}}).then(n=>n.json()).then(function(t){n=transformDataforSetupChart(t);chartRecibidos.data.labels=n.labels;chartRecibidos.data.datasets.push(n.datasets);chartRecibidos.update();n.checkSum==0&&notifyFacade("No hay información que mostrar")}).catch(()=>{notifyFacade("Sin servicio, intenta más tarde"),console.log("Algo fue mal en la recuperación de recibidos")})}function setupInitDataEnviados(){var n=[],t=objWebRoot.route+"api/v1/estadisticas/enviados/"+objUser.username;fetch(t,{headers:{Authorization:"Bearer "+objWebRoot.token}}).then(n=>n.json()).then(function(t){n=transformDataforSetupChart(t);chartEnviados.data.datasets.push(n.datasets);chartEnviados.data.labels=n.labels;chartEnviados.update();n.checkSum==0&&notifyFacade("No hay información que mostrar En Enviados")}).catch(()=>{notifyFacade("Sin servicio, intenta más tarde"),console.log("Algo fue mal en la recuperación de enviados")})}function setupNewDataRecibidos(n){removeData(chartRecibidos);var t=[];fetch(n,{headers:{Authorization:"Bearer "+objWebRoot.token}}).then(n=>n.json()).then(function(n){t=transformDataforChart(n);addData(chartRecibidos,t.datasets);t.checkSum==0&&notifyFacade("No hay información que mostrar en Recibidos")}).catch(()=>{notifyFacade("Sin servicio, intenta más tarde"),console.log("Algo fue mal en la actualización derecibidos")})}function setupNewDataEnviados(n){removeData(chartEnviados);var t=[];fetch(n,{headers:{Authorization:"Bearer "+objWebRoot.token}}).then(n=>n.json()).then(function(n){t=transformDataforChart(n);addData(chartEnviados,t.datasets);t.checkSum==0&&notifyFacade("No hay información que mostrar")}).catch(()=>{notifyFacade("Sin servicio, intenta más tarde"),console.log("Algo fue mal en la actualización de enviados")})}function createChartRoute(n,t,i,r){var f=objWebRoot.route+"api/v1/estadisticas/"+r+"/"+objUser.username+"?",e,u;return n&&n!="all"&&(f+="categoria="+n),t&&!i&&(e=getCleanDate(t),u=getCleanDate(new Date),f+="&fechainicio="+e+"&fechafin="+u),!t&&i&&(u=getCleanDate(i),f+="&fechafin="+u),t&&i&&(e=getCleanDate(t),u=getCleanDate(i),f+="&fechainicio="+e+"&fechafin="+u),f}function transformDataforChart(n){var t=[],i=0,r;return n.Recibidos&&(r=n.Recibidos),n.Enviados&&(r=n.Enviados),i+=n.Respuestas,t.push(n.Respuestas),r.forEach(function(n){i+=n.Total;t.push(n.Total)}),{datasets:{data:t,backgroundColor:["#FF7267","#FFCF67","#4FB1BF","#7C5FCB","#E15AA1","#FF9F46",]},checkSum:i}}function transformDataforSetupChart(n){var t=[],i=[],r=0,u;return n.Recibidos&&(u=n.Recibidos),n.Enviados&&(u=n.Enviados),r+=n.Respuestas,t.push(n.Respuestas),i.push("Respuestas"),u.forEach(function(n){r+=n.Total;i.push(n.Estado);t.push(n.Total)}),{datasets:{data:t,backgroundColor:["#FF7267","#FFCF67","#4FB1BF","#7C5FCB","#E15AA1","#FF9F46",]},labels:i,checkSum:r}}function setupGraficos(){Chart.defaults.global.plugins.labels={render:"percentage",fontColor:"#ffffff",fontStyle:"bold",fontSize:14};const n=$("#graficoRecibidos"),t=$("#graficoEnviados");chartRecibidos=new Chart(n,{type:"doughnut",options:{responsive:!0}});setupInitDataRecibidos();chartEnviados=new Chart(t,{type:"pie",options:{responsive:!0}});setupInitDataEnviados()}function removeData(n){n.data.datasets.splice(0,1);n.update()}function addData(n,t){n.data.datasets.push(t);n.update()}function notifyFacade(n){$.getScript(objWebRoot.route+"lib/bootstrap-notify/bootstrap-notify.js",function(){$.notify({message:n},{type:"info",newest_on_top:!0,delay:3e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})})}var chartRecibidos,chartEnviados,objWebRoot={route:"",token:""},objUser={username:""};(function(){objWebRoot.route=$("#routeWebRoot").val();objWebRoot.token=$("#TokenWebApi").val();objUser.username=$("#user").text();setupCategorias();setupGraficos();$("#checkFiltrar").prop("checked",!1);$("#datePickerStart").prop("max",function(){return(new Date).toJSON().split("T")[0]});$("#datePickerEnd").prop("max",function(){return(new Date).toJSON().split("T")[0]})})();$("#aplicarFiltroBoton").click(function(){var n=document.getElementById("categoriasSelect"),t=n.options[n.selectedIndex].value,i=$("#datePickerEnd").datepicker("getDate"),r=$("#datePickerStart").datepicker("getDate");const u=createChartRoute(t,r,i,"recibidos");setupNewDataRecibidos(u);const f=createChartRoute(t,r,i,"enviados");setupNewDataEnviados(f)});$("#checkFiltrar").change(function(){if(!this.checked){$("#datePickerStart").datepicker("clearDates");$("#datePickerEnd").datepicker("clearDates");$("#categoriasSelect").val($("#categoriasSelect").data("default-value"));var n=objWebRoot.route+"api/v1/estadisticas/recibidos/"+objUser.username;setupNewDataRecibidos(n);n=objWebRoot.route+"api/v1/estadisticas/enviados/"+objUser.username;setupNewDataEnviados(n)}});