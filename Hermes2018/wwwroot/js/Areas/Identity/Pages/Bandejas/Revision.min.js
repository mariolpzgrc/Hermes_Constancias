function ObtenerBandeja(n){objRevision.urln=objBusqueda.cadena.length===0&&objCategorias.categoriaId===0&&objFechas.inicio.length>0&&objFechas.fin.length>0?objWebRoot.route+"api/v1/documentos/revision/"+objUser.username+"/"+n+"?fechaini="+objFechas.inicio+"&fechafin="+objFechas.fin:objBusqueda.cadena.length>0&&objCategorias.categoriaId===0&&objFechas.inicio.length===0&&objFechas.fin.length===0?objWebRoot.route+"api/v1/documentos/revision/"+objUser.username+"/"+n+"?busqueda="+objBusqueda.cadena:objBusqueda.cadena.length===0&&objCategorias.categoriaId>0&&objFechas.inicio.length===0&&objFechas.fin.length===0?objWebRoot.route+"api/v1/documentos/revision/"+objUser.username+"/"+n+"?categoria="+objCategorias.categoriaId:objBusqueda.cadena.length>0&&objCategorias.categoriaId>0&&objFechas.inicio.length===0&&objFechas.fin.length===0?objWebRoot.route+"api/v1/documentos/revision/"+objUser.username+"/"+n+"?busqueda="+objBusqueda.cadena+"&categoria="+objCategorias.categoriaId:objBusqueda.cadena.length>0&&objCategorias.categoriaId===0&&objFechas.inicio.length>0&&objFechas.fin.length>0?objWebRoot.route+"api/v1/documentos/revision/"+objUser.username+"/"+n+"?busqueda="+objBusqueda.cadena+"&fechaini="+objFechas.inicio+"&fechafin="+objFechas.fin:objBusqueda.cadena.length===0&&objCategorias.categoriaId>0&&objFechas.inicio.length>0&&objFechas.fin.length>0?objWebRoot.route+"api/v1/documentos/revision/"+objUser.username+"/"+n+"?categoria="+objCategorias.categoriaId+"&fechaini="+objFechas.inicio+"&fechafin="+objFechas.fin:objBusqueda.cadena.length>0&&objCategorias.categoriaId>0&&objFechas.inicio.length>0&&objFechas.fin.length>0?objWebRoot.route+"api/v1/documentos/revision/"+objUser.username+"/"+n+"?busqueda="+objBusqueda.cadena+"&categoria="+objCategorias.categoriaId+"&fechaini="+objFechas.inicio+"&fechafin="+objFechas.fin:objWebRoot.route+"api/v1/documentos/revision/"+objUser.username+"/"+n;$.ajax({url:objRevision.urln,type:"GET",dataType:"json",async:!0,beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token);objRevision.info=Object.keys({});$("#contiene-cargador .loader").removeClass("d-none");$("#Revision tbody").fadeOut(100,"linear")},success:function(n){objRevision.info=Object.keys({});objRevision.info=n},error:function(){objRevision.info=Object.keys({});$("#contiene-cargador .loader").removeClass("d-none").addClass("d-none")},complete:function(){objRevision.info.Datos.length>0?(objPaginacion.opciones.startPage=n,objPaginacion.opciones.totalPages=objRevision.info.Total_Paginas,$("#contenedor-paginacion ul").empty(),$("#paginacion-revision").twbsPagination("destroy"),$("#paginacion-revision").twbsPagination(objPaginacion.opciones)):($("#contenedor-paginacion ul").empty(),$("#paginacion-revision").twbsPagination("destroy"));ProcesaBandeja();$("#contiene-cargador .loader").removeClass("d-none").addClass("d-none");$("#Revision tbody").fadeIn(500,"linear")}})}function ProcesaBandeja(){$("#Revision tbody").empty();objRevision.info.Datos.length>0?(objElementos.elementospaginaactual=objRevision.info.Elementos_Pagina_Actual,$.each(objRevision.info.Datos,function(n,t){objtr.elementobase=Object.keys({});objtr.elementobase=$("<tr>").append($("<td>").append($('<a class="font-dark" href="'+objWebRoot.route+"Correspondencia/Revision/"+t.RevisionId+'">'+t.Folio+"<\/a>")),$("<td>").append($('<a class="font-dark" href="'+objWebRoot.route+"Correspondencia/Revision/"+t.RevisionId+'">'+t.Destinatario+"<\/a>")),$("<td>").append($('<a class="font-dark" href="'+objWebRoot.route+"Correspondencia/Revision/"+t.RevisionId+'">'+t.Asunto+"<\/a>")),$("<td>").append(t.NoInternol?$('<a class="font-dark" href="'+objWebRoot.route+"Correspondencia/Revision/"+t.EnvioId+"/"+t.TipoEnvio+'">'+t.NoInterno+"<\/a>"):""),$("<td>").append($('<a class="font-dark" href="'+objWebRoot.route+"Correspondencia/Revision/"+t.RevisionId+'">'+moment(t.Fecha).locale("es").format("DD[/]MM[/]YYYY HH:mm [hrs.]")+"<\/a>")),$("<td>").append(t.Importancia?$('<div data-toggle="tooltip" data-placement="top" title="Importancia alta"><i class="fas fa-exclamation font-red"><\/i><\/div>'):""),$("<td>").append(t.Adjuntos?$('<div data-toggle="tooltip" data-placement="top" title="Archivos adjuntos disponibles"><i class="fas fa-paperclip font-gray"><\/i><\/div>'):""));$("#Revision tbody").append(objtr.elementobase)})):(objtr.elementobase=Object.keys({}),objtr.elementobase=$('<tr class="table-light">').append($('<td colspan="6" class="text-center">').text("Sin documentos para mostrar")),$("#Revision tbody").append(objtr.elementobase))}function ControlBusqueda(){jQuery(document).on("keyup","input#searchbox",function(n){if(objBusqueda.cadena=$(this).val().trim(),n.which===13)return objBusqueda.cadena=objBusqueda.cadena.replace(/ /g,"+"),objBusqueda.seBusco=!0,ObtenerBandeja(1),!1;objBusqueda.cadena.length>0?$("#btn-x-search").removeClass("d-none"):($("#btn-x-search").removeClass("d-none").addClass("d-none"),objBusqueda.cadena="",objBusqueda.seBusco&&(objBusqueda.seBusco=!1,ObtenerBandeja(1)))});$("#btn-x-search").on("click",function(){$("input#searchbox").val("");$("#btn-x-search").removeClass("d-none").addClass("d-none");objBusqueda.cadena="";objBusqueda.seBusco&&(objBusqueda.seBusco=!1,ObtenerBandeja(1))})}function ObtenerCategorias(){objCategorias.urln=objWebRoot.route+"api/v1/categorias/"+objUser.username;$.ajax({url:objCategorias.urln,type:"GET",dataType:"json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){objCategorias.info=Object.keys({});objCategorias.info=n},error:function(){objCategorias.info=Object.keys({})},complete:function(){objCategorias.info.length>0?($("#select-categorias").empty(),$("#select-categorias").append($("<option><\/option>").val("0").html("[Todas las categorías]")),$.each(objCategorias.info,function(n,t){$("#select-categorias").append($("<option><\/option>").val(t.CategoriaId).html(t.Nombre))})):($("#select-categorias").empty(),$("#select-categorias").append($("<option><\/option>").val("0").html("[Todas las categorías]")))}});$("#select-categorias").change(function(){objCategorias.categoriaId=parseInt($("#select-categorias option:selected").val());ObtenerBandeja(1)})}function ControlFechas(){$('input[name="datepicker1"]').daterangepicker({opens:"left",autoUpdateInput:!1,locale:{format:"DD/MM/YYYY",cancelLabel:"Limpiar",applyLabel:"Aplicar",fromLabel:"De",toLabel:"a",daysOfWeek:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],monthNames:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}});$('input[name="datepicker1"]').on("apply.daterangepicker",function(n,t){$(this).val(t.startDate.format("DD/MM/YYYY")+" - "+t.endDate.format("DD/MM/YYYY"));objFechas.inicio=t.startDate.format("DD/MM/YYYY");objFechas.fin=t.endDate.format("DD/MM/YYYY");objFechas.seBusco=!0;ObtenerBandeja(1)});$('input[name="datepicker1"]').on("cancel.daterangepicker",function(){$(this).val("");objFechas.inicio="";objFechas.fin="";objFechas.seBusco&&(objFechas.seBusco=!1,ObtenerBandeja(1))})}function ControlExportarPDF(){objRevision.exportar=Object.keys({});$.each(objRevision.info.Datos,function(n,t){objRevision.exportar.push({folio:t.Folio,destinatario:t.Destinatario,asunto:t.Asunto,fecha:moment(t.Fecha).locale("es").format("DD[/]MM[/]YYYY HH:mm [hrs.]"),importancia:t.Importancia?"Alta":"Normal",adjuntos:t.Adjuntos?"Si":"No"})});objRevision.descarga=Object.keys({});objRevision.descarga=new jsPDF;objRevision.descarga.autoTable({columns:[{header:"Folio",dataKey:"folio"},{header:"Destinatario",dataKey:"destinatario"},{header:"Asunto",dataKey:"asunto"},{header:"Fecha",dataKey:"fecha"},{header:"Importancia",dataKey:"importancia"},{header:"Adjuntos",dataKey:"adjuntos"}],body:objRevision.exportar,margin:{top:5,bottom:5,right:5,left:5},theme:"striped",headStyles:{fillColor:[0,131,143]},styles:{font:"helvetica",fontStyle:"normal",fontSize:6,overflow:"linebreak",cellWidth:"auto"}});objRevision.descarga.save("ListadoRevision.pdf")}function ControlExportarExcel(){objRevision.exportar=Object.keys({});objRevision.exportar.push([{text:"Folio"},{text:"Destinatario"},{text:"Asunto"},{text:"Fecha"},{text:"Importancia"},{text:"Adjuntos"}]);$.each(objRevision.info.Datos,function(n,t){objRevision.exportar.push([{text:t.Folio},{text:t.Destinatario},{text:t.Asunto},{text:moment(t.Fecha).locale("es").format("DD[/]MM[/]YYYY HH:mm [hrs.]")},{text:t.Importancia?"Alta":"Normal"},{text:t.Adjuntos?"Si":"No"}])});Jhxlsx.export([{sheetName:"Revisión",data:objRevision.exportar}],{fileName:"ListadoRevision",extension:".xlsx",sheetName:"Hoja1",fileFullName:"ListadoRevision.xlsx",header:!0,maxCellWidth:30})}function ControlExportar(){$("#exportar-pdf").click(function(){ControlExportarPDF()});$("#exportar-excel").click(function(){ControlExportarExcel()})}var objWebRoot={route:"",token:""},objUser={username:""},objRevision={urln:"",info:Object.keys({}),exportar:[],descarga:Object.keys({})},objtr={elementobase:Object.keys({})},objElementos={elementospaginaactual:0},objBusqueda={cadena:"",seBusco:!1},objPaginacion={opciones:{totalPages:1,visiblePages:3,startPage:1,initiateStartPageClick:!1,pageVariable:"{{pagina}}",first:"Primero",prev:"Anterior",next:"Siguiente",last:"Último",onPageClick:function(n,t){ObtenerBandeja(t)}}},objCategorias={urln:"",info:Object.keys({}),categoriaId:0},objFechas={inicio:"",fin:"",seBusco:!1};$(document).ready(function(){objWebRoot.route=$("#routeWebRoot").val();objWebRoot.token=$("#TokenWebApi").val();objUser.username=$("#user").text();ObtenerBandeja(1);ControlBusqueda();ObtenerCategorias();ControlFechas();ControlExportar()});