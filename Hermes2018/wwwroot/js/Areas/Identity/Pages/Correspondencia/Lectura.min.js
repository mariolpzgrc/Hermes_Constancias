function LecturaArchivos(){objListadoArchivos.urln=objWebRoot.route+"api/v1/anexos/descarga/envios";objListadoArchivos.paramFolio=$("#folioInput").text();objListadoArchivos.datos=Object.keys({});$.ajax({url:objListadoArchivos.urln,type:"POST",data:JSON.stringify({Folio:objListadoArchivos.paramFolio,TipoEnvioId:objParam.tipoEnvio,EnvioId:objParam.envioId}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){n!==""&&(objListadoArchivos.datos=Object.keys({}),objListadoArchivos.datos=n,$.each(objListadoArchivos.datos,function(n,t){$("#containerArchivos").append($('<span class="tm-tag cm-tag"><a class="cmt-titulo" href="'+objWebRoot.route+t.Ruta+'" download>'+t.Nombre+"<\/a><\/span>"))}))}})}function LecturaArchivosOrigen(){objListadoArchivos.urln=objWebRoot.route+"api/v1/anexos/descarga/enviosOrigen";objListadoArchivos.paramFolio=$("#folioInput").text();objListadoArchivos.datos=Object.keys({});$.ajax({url:objListadoArchivos.urln,type:"POST",data:JSON.stringify({Folio:objListadoArchivos.paramFolio,TipoEnvioId:objParamOrigen.tipoEnvio,EnvioId:objParamOrigen.envioId}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){n!==""&&(objListadoArchivos.datos=Object.keys({}),objListadoArchivos.datos=n,$.each(objListadoArchivos.datos,function(n,t){$("#containerArchivosOrigen").append($('<div class="tm-tag cm-tag"><a class="cmt-titulo" href="'+objWebRoot.route+t.Ruta+'" download>'+t.Nombre+"<\/a><\/div>"))}))}})}function ObtenerCategoriasRecepcion(){objCategoriasRecepcion.urln=objWebRoot.route+"api/v1/categorias/recepcion/seleccionadas";$.ajax({url:objCategoriasRecepcion.urln,type:"POST",data:JSON.stringify({Usuario:objUser.username,Folio:$("#folioInput").text(),EnvioId:objParam.envioId,TipoEnvio:objParam.tipoEnvio}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){objCategoriasRecepcion.seleccionadas=[];$.each(n,function(n,t){t.Estado?(t.Nombre==="General"?$("#tagsSaver").append('<input type="checkbox" class="categorias" id="catGeneral" value="'+t.CategoriaId+'" checked="true"/><small> '+t.Nombre+"<\/small><br/>"):$("#tagsSaver").append('<input type="checkbox" class="categorias" value="'+t.CategoriaId+'" checked="true"/><small> '+t.Nombre+"<\/small><br/>"),objCategoriasRecepcion.seleccionadas.push(parseInt(t.CategoriaId))):t.Nombre==="General"?$("#tagsSaver").append('<input type="checkbox" class="categorias" id="catGeneral" value="'+t.CategoriaId+'"/><small> '+t.Nombre+"<\/small><br/>"):$("#tagsSaver").append('<input type="checkbox" class="categorias" value="'+t.CategoriaId+'"/><small> '+t.Nombre+"<\/small><br/>")});$("#catSeleccionadas").text(objCategoriasRecepcion.seleccionadas.join(","));SeleccionCategoria()}})}function ObtenerCategoriasEnvio(){objCategoriasEnvio.urln=objWebRoot.route+"api/v1/categorias/envio/seleccionadas";$.ajax({url:objCategoriasEnvio.urln,type:"POST",data:JSON.stringify({Usuario:objUser.username,Folio:$("#folioInput").text(),EnvioId:objParam.envioId,TipoEnvio:objParam.tipoEnvio}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){objCategoriasEnvio.seleccionadas=[];$.each(n,function(n,t){t.Estado&&($("#tagsSaver").append('<span class="ml-1 badge badge-light">'+t.Nombre+"<\/span>"),objCategoriasEnvio.seleccionadas.push(parseInt(t.CategoriaId)))})}})}function ObtenerCategoriasRecepcionSoloLectura(){objCategoriasRecepcion.urln=objWebRoot.route+"api/v1/categorias/recepcion/seleccionadas";$.ajax({url:objCategoriasRecepcion.urln,type:"POST",data:JSON.stringify({Usuario:objUser.username,Folio:$("#folioInput").text(),EnvioId:objParam.envioId,TipoEnvio:objParam.tipoEnvio}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){objCategoriasRecepcion.seleccionadas=[];$.each(n,function(n,t){t.Estado&&($("#tagsSaver").append('<span class="ml-1 badge badge-light">'+t.Nombre+"<\/span>"),objCategoriasRecepcion.seleccionadas.push(parseInt(t.CategoriaId)))});$("#catSeleccionadas").text(objCategoriasRecepcion.seleccionadas.join(","))}})}function ControlCategoria(){$("#tagsSaver").append('<div id="checkboxAdd"><small><div class=""><input class="form-control form-control-sm font-regular-10" id="nameTag" placeholder="Nombre categoría" required maxlength="100"/><\/div><div class="mb-2 text-center"><button id="agregarCategoria" type="button" class="btn btn-primary btn-sm pr-2 pl-2 mr-1"><i class="fa fa-check"><\/i><\/button><button class="btn btn-light btn-sm pr-2 pl-2" type="button" onclick="CancelarNuevaCategoria()"><i class="fas fa-times"><\/i><\/button><\/div><\/small><\/div>');$("#buttonCategoria").prop("disabled",!0);AgregarCategoria()}function AgregarCategoria(){objCategoria.urln=objWebRoot.route+"api/v1/categorias/agregar";$("#agregarCategoria").click(function(){$("#nameTag").val().length>0?($("#txtAviso").removeClass("d-none").addClass("d-none").text(""),$.ajax({url:objCategoria.urln,type:"POST",data:JSON.stringify({Usuario:objUser.username,Categoria:$("#nameTag").val()}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){n.Estado===1?($("#tagsSaver").append('<input type="checkbox" class="categorias" value="'+n.CategoriaId+'"/><small> '+n.Nombre+"<\/small><br/>"),$("#checkboxAdd").empty(),$("#checkboxAdd").remove(),$("#buttonCategoria").prop("disabled",!1),SeleccionCategoria()):n.Estado===3?Notifica("No se puede guardar la categoría, ya existe una con el mismo nombre."):(n.Estado===2||n.Estado===4)&&Notifica("No se puede guardar la categoría, inténtelo más tarde.")}})):$("#txtAviso").removeClass("d-none").text("El nombre de la categoría es requerido.")})}function CancelarNuevaCategoria(){$("#checkboxAdd").empty();$("#checkboxAdd").remove();$("#buttonCategoria").prop("disabled",!1)}function SeleccionCategoria(){$("#tagsSaver input[type=checkbox]").on("change",function(){objActualizarOficio.categoriasSeleccionadas=[];$("#tagsSaver input[type=checkbox]:checked").length===0&&$("input#catGeneral").prop("checked",!0);$("#tagsSaver input[type=checkbox]:checked").each(function(){objActualizarOficio.categoriasSeleccionadas.push(parseInt($(this).val()))});$("#catSeleccionadas").text(objActualizarOficio.categoriasSeleccionadas.join(","))})}function ActualizarOficio(){objActualizarOficio.categorias=$("#catSeleccionadas").text();objActualizarOficio.urln=objWebRoot.route+"api/v1/categorias/recepcion/actualizar";$.ajax({url:objActualizarOficio.urln,type:"POST",data:JSON.stringify({EnvioId:objParam.envioId,Usuario:objUser.username,Categorias:objActualizarOficio.categorias,TipoEnvio:objParam.tipoEnvio}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){parseInt(n.Estado)===1?Notifica("Se ha guardado correctamente la(s) categoría(s) del documento"):Notifica("En este momento, no se puede guardar la(s) categoría(s) al oficio, inténtelo más tarde.")}})}function ControlVisualizacion(){$("#contenedor-destiantarios a").click(function(){return window.open(this.href,"","width=960,height=980,menubar=no,resizable=no,status=no",!0),!1})}function Notifica(n){$.notify({message:n},{type:"info",newest_on_top:!0,delay:3e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}function ControlFecha(){$("#btnCambiar").click(function(){$("#contieneAgregarFecha").removeClass("d-none");$("#btnCambiar").prop("disabled",!0)});$("#btnAgregarFecha").click(function(){$("#fechaCompromiso").val()!=""&&$.ajax({url:objWebRoot.route+"api/v1/documentos/compromiso/cambiar",type:"POST",data:JSON.stringify({RecepcionId:objDocumento.recepcionId,Fecha:$("#fechaCompromiso").val()}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){n.Estado==1&&($("#contieneAgregarFecha").removeClass("d-none"),$("#contieneAgregarFecha").addClass("d-none"),$("#fechaCompromisoActual").text($("#fechaCompromiso").val()),$("#fechaCompromiso").val(""),$("#btnCambiar").prop("disabled",!1))}})});$("#btnCancelarFecha").click(function(){$("#contieneAgregarFecha").removeClass("d-none");$("#contieneAgregarFecha").addClass("d-none");$("#fechaCompromiso").val("");$("#btnCambiar").prop("disabled",!1)})}function toPlainString(n){var t="";return n.forEach(function(n,i,r){t+=r.length-1===i?n:n+","}),t}function getEmailsParaToSend(){var n=[],t=$("#form-autocomplete-para").val(),i;if(t)return i=JSON.parse(t),i.forEach(function(t){n.includes(t.value)||n.push(t.value)}),toPlainString(n)}function updateHelperDataEmails(){$("#EnvioCorreo_Correo").val(getEmailsParaToSend())}function ControlAutocompletarPara(){function t(){updateHelperDataEmails()}const n=document.getElementById("form-autocomplete-para");updateHelperDataEmails();tagifyEmailsPara=new Tagify(n,{maxTags:20,pattern:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/});tagifyEmailsPara.on("add",t)}function ControlTramites(){objTramite.tipo=parseInt($("select#NuevoCompromiso_TramiteId option:selected").val());objTramite.dias=parseInt($("select#NuevoCompromiso_TramiteId option:selected").data("tdias"));$.ajax({url:objWebRoot.route+"api/v1/calendario/info/"+objTramite.dias+"/"+objDocumento.recepcionId,type:"GET",datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){($.trim(n)!=null||$.trim(n)!=undefined)&&(objCalendario.dias=n.Dias,objCalendario.datos=objCalendario.dias.split(","),objCalendario.inicio=n.Inicio,objCalendario.limite=n.Limite,objCalendario.esVigente=n.EsVigente,objCalendario.configuracion.disable=objCalendario.datos,objCalendario.configuracion.minDate=objCalendario.inicio,objCalendario.configuracion.maxDate=objCalendario.limite,objTramite.tipo==objTramite.const.general?(objCalendario.configuracion.defaultDate=objParam.fechaPropuesta,objCalendario.configuracion.clickOpens=!0):(objCalendario.configuracion.defaultDate=objCalendario.limite,objCalendario.configuracion.clickOpens=!1),objCalendario.datePicker=flatpickr("#NuevoCompromiso_FechaCompromiso",objCalendario.configuracion),objCalendario.esVigente<0?($("#NuevoCompromiso_FechaCompromiso").removeClass("text-danger"),$("#NuevoCompromiso_FechaCompromiso").addClass("text-danger")):$("#NuevoCompromiso_FechaCompromiso").removeClass("text-danger"))}});$("select#NuevoCompromiso_TramiteId").change(function(){objTramite.tipo=parseInt($("select#NuevoCompromiso_TramiteId option:selected").val());objTramite.dias=parseInt($("select#NuevoCompromiso_TramiteId option:selected").data("tdias"));$.ajax({url:objWebRoot.route+"api/v1/calendario/info/"+objTramite.dias+"/"+objDocumento.recepcionId,type:"GET",datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){($.trim(n)!=null||$.trim(n)!=undefined)&&(objCalendario.dias=n.Dias,objCalendario.datos=objCalendario.dias.split(","),objCalendario.inicio=n.Inicio,objCalendario.limite=n.Limite,objCalendario.esVigente=n.EsVigente,objCalendario.configuracion.disable=objCalendario.datos,objCalendario.configuracion.minDate=objCalendario.inicio,objCalendario.configuracion.maxDate=objCalendario.limite,objTramite.tipo==objTramite.const.general?(objCalendario.configuracion.defaultDate=objParam.fechaPropuesta,objCalendario.configuracion.clickOpens=!0):(objCalendario.configuracion.defaultDate=objCalendario.limite,objCalendario.configuracion.clickOpens=!1),objCalendario.datePicker.destroy(),objCalendario.datePicker=flatpickr("#NuevoCompromiso_FechaCompromiso",objCalendario.configuracion),objCalendario.esVigente<0?($("#NuevoCompromiso_FechaCompromiso").removeClass("text-danger"),$("#NuevoCompromiso_FechaCompromiso").addClass("text-danger")):$("#NuevoCompromiso_FechaCompromiso").removeClass("text-danger"))}})})}function Control2Tramites(){objCalendario.dias=$("#Inhabiles_Dias").val();objCalendario.datos=objCalendario.dias.split(",");objCalendario.inicio=$("#Inhabiles_Inicio").val();objCalendario.limite=$("#Inhabiles_Limite").val();objCalendario.esVigente=parseInt($("#Inhabiles_EsVigente").val());objCalendario.configuracion.disable=objCalendario.datos;objCalendario.configuracion.minDate=objCalendario.inicio;objCalendario.configuracion.maxDate=objCalendario.limite;objCalendario.configuracion.defaultDate=$.trim($("#fechaCompromisoActual").text());objCalendario.datePicker=flatpickr("#NuevoCompromiso_FechaCompromiso",objCalendario.configuracion);objCalendario.esVigente<0?($("#NuevoCompromiso_FechaCompromiso").removeClass("text-danger"),$("#NuevoCompromiso_FechaCompromiso").addClass("text-danger")):$("#NuevoCompromiso_FechaCompromiso").removeClass("text-danger")}var objp={urln:""},objd={urln:""},objc={urln:""},obja={urln:""},objWebRoot={route:"",token:""},objUser={username:"",usersession:""},objParam={envioId:0,tipoVisualizacion:0,tipoEnvio:0,esTurnado:!1,existeAdjuntos:!1,tieneRespuesta:!1,fechaPropuesta:"",esReenvio:!1},objParamOrigen={envioId:0,tipoEnvio:0,existeAdjuntos:!1},objDelegar={estaActiva:!1,tipoPermiso:0},objTipoVisualizacion={recepcion:1,envio:2},objTipoEnvio={envio:1,turnar:2,respuestaParcial:3,respuesta:4,reenvio:5},objDocumento={envioId:0,tipoEnvioId:0,recepcionId:0},objCalendario={datePicker:null,dias:"",datos:[],inicio:"",limite:"",esVigente:0,configuracion:null},objTramite={tipo:0,dias:0,"const":{general:1}},objListadoArchivos,objCategoriasRecepcion,objCategoriasEnvio,objCategoria,objActualizarOficio;$(function(){objUser.username=$("#user").text();objUser.usersession=$("#FolioSession").val();objWebRoot.route=$("#routeWebRoot").val();objWebRoot.token=$("#TokenWebApi").val();objParam.envioId=parseInt($("#envio_identifica").text());objParam.tipoVisualizacion=parseInt($("#tipo_visualizacion").text());objParam.tipoEnvio=parseInt($("#tipo_envio").text());objParam.esTurnado=$("#es_turnado").text().toLowerCase()==="true"?!0:!1;objParam.esReenvio=$("#es_reenvio").text().toLowerCase()==="true"?!0:!1;objParam.existeAdjuntos=$("#existe_adjuntos").text().toLowerCase()==="true"?!0:!1;objParam.tieneRespuesta=$("#tiene_respuesta").text().toLowerCase()==="true"?!0:!1;objParam.fechaPropuesta=$("#fecha_propuesta").text();objParamOrigen.envioId=parseInt($("#origen_envio_identifica").text());objParamOrigen.tipoEnvio=parseInt($("#origen_tipo_envio").text());objParamOrigen.existeAdjuntos=$("#origen_existe_adjuntos").text().toLowerCase()==="true"?!0:!1;objDelegar.estaActiva=$("#InfoDelegar_EstaActiva").val()=="True";objDelegar.tipoPermiso=objDelegar.estaActiva?parseInt($("#InfoDelegar_TipoPermiso").val()):0;objDocumento.envioId=$("#NuevoCompromiso_EnvioId").val();objDocumento.tipoEnvioId=$("#NuevoCompromiso_TipoEnvioId").val();objDocumento.recepcionId=$("#NuevoCompromiso_RecepcionId").val();objCalendario.configuracion={dateFormat:"d/m/Y",clickOpens:!0,locale:{firstDayOfWeek:7,weekdays:{shorthand:["Do","Lu","Ma","Mi","Ju","Vi","Sa"],longhand:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"]},months:{shorthand:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Оct","Nov","Dic"],longhand:["Enero","Febrero","Мarzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"]}},disable:"",minDate:"",maxDate:"",defaultDate:""};objParam.tipoVisualizacion===objTipoVisualizacion.envio?ObtenerCategoriasEnvio():objParam.tipoVisualizacion===objTipoVisualizacion.recepcion&&(objDelegar.estaActiva===!1||objDelegar.estaActiva===!0&&objDelegar.tipoPermiso===1?(ObtenerCategoriasRecepcion(),$("#buttonCategoria").click(function(){ControlCategoria()}),$("#buttonActualizar").click(function(){ActualizarOficio()}),objParam.tieneRespuesta==!1):ObtenerCategoriasRecepcionSoloLectura());objParam.existeAdjuntos&&LecturaArchivos();(objParam.esTurnado||objParam.esReenvio&&objParam.tipoEnvio===1)&&objParamOrigen.existeAdjuntos&&LecturaArchivosOrigen();ControlVisualizacion();objDocumento.tipoEnvioId==objTipoEnvio.envio?ControlTramites():objDocumento.tipoEnvioId==objTipoEnvio.turnar&&Control2Tramites();ControlAutocompletarPara();console.log($("#containerMailsFor").html());var n=document.getElementById("containerMailsFor").innerHTML;console.log(n)});$.validator.setDefaults({ignore:[]});objListadoArchivos={urln:"",paramFolio:"",datos:Object.keys({})};objCategoriasRecepcion={seleccionadas:[],urln:""};objCategoriasEnvio={seleccionadas:[],urln:""};objCategoria={urln:""};objActualizarOficio={categoriasSeleccionadas:[],categorias:"",urln:""};$("#download-pdf").click(function(n){n.preventDefault();var t=window.location.pathname.split("/").pop();$.ajax({url:$("#routeWebRoot").val()+"api/v1/PdfOficios/"+parseInt(t),type:"GET",datatype:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(){redirectUrl=$("#routeWebRoot").val()+"api/v1/PdfOficios/"+parseInt(t);window.open(redirectUrl,"_blank")}})});