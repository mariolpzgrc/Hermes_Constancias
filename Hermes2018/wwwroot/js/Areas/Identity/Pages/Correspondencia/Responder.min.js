function ControlTipoDocumento(){objTipoDocumento.seleccionado=parseInt($("#Responder_TipoId option:selected").val());objTipoDocumento.seleccionado===objTipoDocumento.memorandum?$("#leyenda-tipo-documento").text("Memorándum"):$("#leyenda-tipo-documento").text("");$("#Responder_TipoId").change(function(){objTipoDocumento.seleccionado=parseInt($("#Responder_TipoId option:selected").val());objTipoDocumento.seleccionado===objTipoDocumento.memorandum?$("#leyenda-tipo-documento").text("Memorándum"):$("#leyenda-tipo-documento").text("")})}function ControlDropzone(){var n={url:objWebRoot.route+"api/v1/anexos/subir/archivo/temporal/"+objUser.usersession,acceptedFiles:objExtensiones.valores,dictDefaultMessage:"Arraste sus archivos aquí o haga clic para abrir el explorador",dictFallbackMessage:"Su navegador no admite la carga de archivos por medio de arrastrar y soltar.",dictFallbackText:"Utilice el formulario de reserva para cargar sus archivos como en los viejos tiempos.",dictFileTooBig:"El archivo es demasiado grande ({{filesize}}MiB). Tamaño máximo de archivo: {{maxFilesize}}MiB.",dictInvalidFileType:"No puedes subir archivos de este tipo.",dictResponseError:"El servidor respondió con el código {{statusCode}}.",dictCancelUpload:"Cancelar carga",dictCancelUploadConfirmation:"¿Estás seguro de que deseas cancelar esta carga?",dictRemoveFile:"Remover archivo",dictMaxFilesExceeded:"No puedes subir más archivos.",dictRemoveFile:"x",createImageThumbnails:!0,addRemoveLinks:!0,maxFiles:10,maxFilesize:25,success:function(n,t){if(t.trim().length>0)$.inArray(t,objarchivos.listado)===-1&&(objarchivos.listado.push(t),objarchivos.cadena="",$.each(objarchivos.listado,function(n,t){objarchivos.cadena=objarchivos.cadena+t;n+1<objarchivos.listado.length&&(objarchivos.cadena=objarchivos.cadena+",")}),$("#Responder_Anexos").val(objarchivos.cadena));else{this.removeFile(n);var i=n.previewElement;i!==null?i.parentNode.removeChild(n.previewElement):void 0}},renameFile:function(n){var t=n.name;t.includes(",")&&(t=t.replace(/,/g,"-"));let i=t;return n.newName=i,i},error:function(n,t){alert(t);this.removeFile(n);var i=n.previewElement;i!==null?i.parentNode.removeChild(n.previewElement):void 0},removedfile:function(n){$.ajax({url:objWebRoot.route+"api/v1/anexos/borrar/archivo/temporal",type:"POST",data:JSON.stringify({Folio:objUser.usersession,NombreArchivo:n.name}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(t){if(t.trim().length>0){objarchivos.indice=$.inArray(t,objarchivos.listado);objarchivos.indice>-1&&objarchivos.listado.splice(objarchivos.indice,1);objarchivos.cadena="";$.each(objarchivos.listado,function(n,t){objarchivos.cadena=objarchivos.cadena+t;n+1<objarchivos.listado.length&&(objarchivos.cadena=objarchivos.cadena+",")});$("#Responder_Anexos").val(objarchivos.cadena);var i=n.previewElement;return i!==null?i.parentNode.removeChild(n.previewElement):void 0}}})},headers:{Authorization:"Bearer "+objWebRoot.token}};$("#uploader").dropzone(n)}function GetCategorias(){objCategorias.urln=objWebRoot.route+"api/v1/categorias/"+objUser.username;$.ajax({url:objCategorias.urln,type:"GET",datatype:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){$.each(n,function(n,t){t.Nombre==="General"?($("#tagsSaver").append('<input type="checkbox" class="categorias" id="catGeneral" value="'+t.CategoriaId+'" checked="true" /><small> '+t.Nombre+"<\/small><br/>"),objCategorias.seleccionadas.push(parseInt(t.CategoriaId))):$("#tagsSaver").append('<input type="checkbox" class="categorias" value="'+t.CategoriaId+'"/><small> '+t.Nombre+"<\/small><br/>")});$("#Responder_Categorias").val(objCategorias.seleccionadas.join(","));SeleccionCategoria()}})}function SeleccionCategoria(){$("#tagsSaver input[type=checkbox]").on("change",function(){objCategorias.seleccionadas=[];$("#tagsSaver input[type=checkbox]:checked").length===0&&$("input#catGeneral").prop("checked",!0);$("#tagsSaver input[type=checkbox]:checked").each(function(){objCategorias.seleccionadas.push(parseInt($(this).val()))});$("#Responder_Categorias").val(objCategorias.seleccionadas.join(","))})}function ControlCategorias(){$("#buttonTag").click(function(){NuevaCategoria()});$(document).on("click","#agregarCategoria",function(){$("#nameTag").val()!==""&&AgregarCategoria()})}function AgregarCategoria(){objc.urln=objWebRoot.route+"api/v1/categorias/agregar";$.ajax({url:objc.urln,type:"POST",data:JSON.stringify({Usuario:objUser.username,Categoria:$("#nameTag").val()}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){n.Estado===1?($("#tagsSaver").append('<input type="checkbox" class="categorias" value="'+n.CategoriaId+'"/><small> '+n.Nombre+"<\/small><br/>"),$("#checkboxAdd").empty(),$("#checkboxAdd").remove(),$("#buttonTag").prop("disabled",!1),SeleccionCategoria()):n.Estado===3?Notifica("No se ha puede guardar la categoría, ya existe una con el mismo nombre."):(n.Estado===2||n.Estado===4)&&Notifica("No se ha puede guardar la categoría, inténtelo más tarde.")}})}function CancelarNuevaCategoria(){$("#checkboxAdd").empty();$("#checkboxAdd").remove();$("#buttonTag").prop("disabled",!1)}function NuevaCategoria(){$("#tagsSaver").append('<div id="checkboxAdd"><small><div class=""><input class="form-control form-control-sm font-regular-10" id="nameTag" placeholder="Nombre categoría" required maxlength="100"/><\/div><div class="mb-2 text-center"><button id="agregarCategoria" type="button" class="btn btn-primary btn-sm pr-2 pl-2 mr-1"><i class="fa fa-check"><\/i><\/button><button class="btn btn-light btn-sm pr-2 pl-2" type="button" onclick="CancelarNuevaCategoria()"><i class="fas fa-times"><\/i><\/button><\/div><\/small><\/div>');$("#buttonTag").prop("disabled",!0)}function getRoute(n){return console.log(n),objWebRoot.route+"api/v1/users/local/"+n}function filterProperties(n){for(var i=[],r,t=0;t<n.length;t++)r={value:$.trim(n[t].HER_NombreCompleto),userName:$.trim(n[t].HER_UserName),searchBy:$.trim(n[t].HER_UserName)+" "+$.trim(n[t].HER_Area),puesto:$.trim(n[t].HER_Puesto),area:$.trim(n[t].HER_Area)},i.push(r);return i}function checkUndefined(n){return n||""}function checkPuestoyArea(n){var t="";return n.puesto&&(t="<br><strong>Puesto: <\/strong>"+n.puesto),n.area&&(t+="<br><strong>Area: <\/strong>"+n.area),t}function getEmailDetails(n){return n.userName+dominioCorreo}function toPlainString(n){var t="";return n.forEach(function(n,i,r){t+=r.length-1===i?n:n+","}),t}function getEmailsCCPToSend(){var n=[],t=$("#form-autocomplete-ccp").val(),i;if(t)return i=JSON.parse(t),i.forEach(function(t){n.includes(t.userName)||n.push(t.userName)}),toPlainString(n)}function updateHelperDataEmails(){$("#Responder_CCP").val(getEmailsCCPToSend())}function RecuperarDatosAutoCompletarCCP(){var n=$("#Responder_CCP").val();CargarUsuarioCCP(n)}function CargarUsuarioCCP(n){var t=[],i=objWebRoot.route+"api/v1/users/local/coleccion";fetch(i,{method:"POST",headers:{Authorization:"Bearer "+objWebRoot.token,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({usuarios:n})}).then(function(n){return n.json()}).then(function(n){t=filterProperties(n);CargarTagAutocompletarCCP(t)}).catch(n=>{console.log("Peticion cancelada"+n)})}function CargarTagAutocompletarCCP(n){tagifyEmailsCCP.settings.whitelist=n;tagifyEmailsCCP.addTags(n)}function ControlAutocompletarCCP(){function i(n,t,i){$.getScript(objWebRoot.route+"lib/bootstrap-notify/bootstrap-notify.js",function(){$.notify({title:n,message:t},{type:"info",element:"#tagsEmailCCP",delay:i,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})})}function r(n){var t=$("#labelfor").text().trim();if(n.value===t){tagifyEmailsCCP.removeTag(n.value);$("#labelfor").removeClass().addClass("shake animated").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).removeClass()})}}function u(t){var i,u,r;console.log(t,t.detail);i=t.detail;i.length>2&&(r=[],tagifyEmailsCCP.settings.whitelist.length=0,n&&n.abort(),n=new AbortController,u=getRoute(i),fetch(u,{signal:n.signal,headers:{Authorization:"Bearer "+objWebRoot.token}}).then(n=>n.json()).then(function(n){n.findIndex(n=>n.HER_UserName===$("#user").text())>-1&&n.splice(n.findIndex(n=>n.HER_UserName===$("#user").text()),1);r=filterProperties(n);tagifyEmailsCCP.settings.whitelist=r;tagifyEmailsCCP.dropdown.show.call(tagifyEmailsCCP,i)}).catch(()=>{}))}function f(n){console.log(n);var i=$("#form-autocomplete-para").val(),t=n.detail.data;r(t);updateHelperDataEmails()}function e(){updateHelperDataEmails()}function o(n){var t=n.detail.data,r;r="<br><strong>Nombre: <\/strong>"+t.value+checkPuestoyArea(t)+"<br><strong>Correo electrónico: <\/strong><br><i>"+getEmailDetails(t)+"<\/i>";i("Detalles del contacto",r,1e4)}const t=document.getElementById("form-autocomplete-ccp");tagifyEmailsCCP=new Tagify(t,{whitelist:[],enforceWhitelist:!0,dropdown:{enabled:3,fuzzySearch:!0,itemTemplate:function(n){return`<div class=tagify__dropdown__item>
                    <span style="font-weight: bold">${n.value}</span>
                    <span style="font-size: small;"> (${n.userName}) </span>
                    <span style="font-size: small; font-style: italic;"> - ${n.puesto} - </span>
                    <span style="font-size: small;">${n.area}</span> 
                </div>`}}});var n;tagifyEmailsCCP.on("input",u);tagifyEmailsCCP.on("add",f);tagifyEmailsCCP.on("remove",e);tagifyEmailsCCP.on("click",o)}function ControlTemplate(){$("#SaveAsTemplate").click(function(){AddTemplate()});$(document).on("click","#BtnSaveTemplate",function(){objrefPlantilla.inputTextNombre=$("#nameTemplate");objrefPlantilla.inputTextNombre.val()!==""?objrefPlantilla.inputTextAreaCuerpo.val()!==""?SaveTemplate():$("#msg-validate-textarea").text("El dato cuerpo es requerido."):$("#msg-validate-textarea").text("El dato Nombre de plantilla es requerido.")});$(document).on("click","#disposeTemplate",function(){$("#msg-validate-textarea").empty();DisposeTemplate()})}function AddTemplate(){$("#msg-validate-template").empty();$("#ButtonsOficio").append('<div id="TemplateForm" class="templateForm"><div><small><input id="nameTemplate" class="form-control form-control-sm text-center font-regular-10 mt-1 mb-1"  placeholder="Nombre de plantilla" required maxlength="100" autocomplete="off"><\/small><\/div><div><small id="msg-validate-textarea" class="text-danger"><\/small><\/div><div><button id="BtnSaveTemplate" class="btn btn-primary btn-sm pr-2 pl-2" type="button"><i class="fa fa-check"><\/i><\/button> <button id="disposeTemplate" class="btn btn-light btn-sm pr-2 pl-2" type="button"><i class="fas fa-times"><\/i><\/button><\/div><\/div>');$("#SaveAsTemplate").prop("disabled",!0)}function SaveTemplate(){var n={cuerpo:"",nombre:"",urln:""};n.cuerpo=$("#Responder_Cuerpo").val();n.nombre=$("#nameTemplate").val();n.urln=objWebRoot.route+"api/v1/plantillas/"+objUser.username;$.ajax({url:n.urln,type:"POST",data:JSON.stringify({HER_Texto:n.cuerpo,HER_Nombre:n.nombre}),contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){n===0?Notifica("No se ha puede guardar la plantilla, inténtelo más tarde."):n===2&&Notifica("No se ha puede guardar la plantilla, ya existe una con el mismo nombre.");GetTemplates()}});$("#TemplateForm").empty();$("#TemplateForm").remove();$("#SaveAsTemplate").prop("disabled",!1);$("#msg-validate-template").text("Plantilla guardada");$("#msg-validate-template").addClass("text-success")}function DisposeTemplate(){$("#TemplateForm").empty();$("#TemplateForm").remove();$("#SaveAsTemplate").prop("disabled",!1);flagTemplateValidation=!1}function AplicarPlantilla(){var n={urln:"",nombre:""};n.nombre=$("#plantillaSelect option:selected").val();n.nombre!==""&&(n.urln=objWebRoot.route+"api/v1/plantillas/"+n.nombre+":"+objUser.username,$.ajax({url:n.urln,type:"GET",datatype:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){objEditor.froala.html.set(n.HER_Texto)}}))}function GetTemplates(){objObtenerPlantillas.urln=objWebRoot.route+"api/v1/plantillas/"+objUser.username;$("#plantillaSelect").empty();$("#plantillaSelect").append("<option selected>Seleccione una plantilla <\/option>");$.ajax({url:objObtenerPlantillas.urln,type:"GET",datatype:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){$.each(n,function(n,t){$("<option>",{value:t.HER_Nombre}).html(t.HER_Nombre).appendTo($("#plantillaSelect"))})}})}function Notifica(n){$.notify({message:n},{type:"info",newest_on_top:!0,delay:3e3,animate:{enter:"animated fadeInDown",exit:"animated fadeOutUp"}})}function LecturaArchivosOrigen(){objListadoArchivos.urln=objWebRoot.route+"api/v1/anexos/descarga/enviosOrigen";objParam.Folio=$("#folio").text();objListadoArchivos.datos=Object.keys({});$.ajax({url:objListadoArchivos.urln,type:"POST",data:JSON.stringify({Folio:objParam.Folio,TipoEnvioId:objParam.tipoEnvio,EnvioId:objParam.envioId}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){n!==""&&(objListadoArchivos.datos=Object.keys({}),objListadoArchivos.datos=n,$.each(objListadoArchivos.datos,function(n,t){$("#containerArchivosOrigen").append($('<div class="tm-tag cm-tag"><a class="cmt-titulo" href="'+objWebRoot.route+t.Ruta+'" download>'+t.Nombre+"<\/a><\/div>"))}))}})}var objWebRoot={route:"",token:""},objUser={username:"",usersession:""},objExtensiones={valores:""},objFolio={folio:""},objTipoDocumento={oficio:1,memorandum:2,seleccionado:0},objParam={envioId:0,Folio:"",tipoEnvio:0,recepcionId:0,existeAdjuntos:!1},objListadoArchivos={urln:"",paramFolio:"",datos:Object.keys({})},tagifyEmails,tagifyEmailsCCP,objEditor={froala:null},objarchivos,objCategorias,objc,objp,dominioCorreo,objrefPlantilla,objObtenerPlantillas;$(function(){objWebRoot.route=$("#routeWebRoot").val();objWebRoot.token=$("#TokenWebApi").val();objUser.username=$("#user").text();objParam.envioId=parseInt($("#envio_identifica").text());objParam.tipoEnvio=parseInt($("#tipo_envio_identifica").text());objParam.existeAdjuntos=$("#existe_adjuntos").text().toLowerCase()==="true"?!0:!1;objUser.usersession=$("#Responder_FolioSession").val();objExtensiones.valores=$("#Responder_Extensiones").val();objFolio.folio=$("#folioInput").val();objEditor.froala=new FroalaEditor("#Responder_Cuerpo",{key:"UBB7jE6D5G3I3A2A6aIVLEABVAYFKc1Ce1MYGD1c1NYVMiB3B9B6B5C2B4C3H3I3I3==",toolbarButtons:["fullscreen","bold","italic","textColor","fontSize","underline","subscript","superscript","|","align","formatOL","formatUL","outdent","indent","|","insertLink","insertTable","|","clearFormatting","selectAll","|","undo","redo"],colorsText:["#000000","#2E64FE","#088A29","#FF0000","#585858","#FFFF00","#8A084B"],attribution:!1,language:"es",heightMin:300,heightMax:400,theme:"gray",placeholderText:"Escriba su documento",wordPasteModal:!0,pastePlain:!0,wordDeniedAttrs:["style","width","height"],quickInsertTags:[""],imageMaxSize:3145728,fontSizeSelection:!0,fontSize:["8","10","12","14","18"],fontSizeDefaultSelection:"16",listAdvancedTypes:!1,imageUploadURL:objWebRoot.route+"api/v1/CargaImagenes/"+objUser.username+"/"+objFolio.folio,requestHeaders:{Authorization:"Bearer "+objWebRoot.token},events:{"image.removed":function(n){$.ajax({method:"POST",url:objWebRoot.route+"api/v1/EliminaImagenes",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},data:{src:n.attr("src")}}).done(function(){console.log("Image was deleted")}).fail(function(n){console.log("Image delete problem: "+JSON.stringify(n))})}}});$("form").each(function(){$(this).data("validator")&&($(this).data("validator").settings.ignore=".fr-box *")});GetCategorias();ControlCategorias();ControlDropzone();ControlAutocompletarCCP();ControlTemplate();RecuperarDatosAutoCompletarCCP();ControlTipoDocumento();$("#plantillaSelect").change(function(){AplicarPlantilla()});objParam.existeAdjuntos&&LecturaArchivosOrigen()});$.validator.setDefaults({ignore:[]});Dropzone.autoDiscover=!1;objarchivos={listado:[],cadena:"",indice:0};objCategorias={urln:"",seleccionadas:[]};objc={urln:""};objp={urln:""};dominioCorreo="@uv.mx";objrefPlantilla={inputTextNombre:null,inputTextAreaCuerpo:$("#Responder_Cuerpo")};objObtenerPlantillas={urln:""};