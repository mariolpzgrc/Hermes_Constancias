function ControlTipoDocumento(){objTipoDocumento.seleccionado=parseInt($("#RevisarDocumento_TipoId option:selected").val());objTipoDocumento.seleccionado===objTipoDocumento.memorandum?$("#leyenda-tipo-documento").text("Memorándum"):$("#leyenda-tipo-documento").text("");$("#RevisarDocumento_TipoId").change(function(){objTipoDocumento.seleccionado=parseInt($("#RevisarDocumento_TipoId option:selected").val());objTipoDocumento.seleccionado===objTipoDocumento.memorandum?$("#leyenda-tipo-documento").text("Memorándum"):$("#leyenda-tipo-documento").text("")})}function LecturaTipoDocumento(){objTipoDocumento.seleccionado=parseInt($("#RevisarDocumento_TipoId").val());objTipoDocumento.seleccionado===objTipoDocumento.memorandum?$("#leyenda-tipo-documento").text("Memorándum"):$("#leyenda-tipo-documento").text("")}function ControlPlantilla(){$("#plantillaSelect").change(function(){objPlantilla.nombre=$("#plantillaSelect option:selected").val();objPlantilla.urln=objWebRoot.route+"api/v1/plantillas/"+objPlantilla.nombre+":"+objUser.username;objPlantilla.nombre!==""&&$.ajax({url:objPlantilla.urln,type:"GET",datatype:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){objEditor.froala.html.set(n.HER_Texto)}})})}function GetCategorias(){objCategorias.seleccionadas=[];objCategorias.urln=objWebRoot.route+"api/v1/categorias/seleccionadas";$.ajax({url:objCategorias.urln,type:"POST",data:JSON.stringify({Usuario:objUser.username,Folio:objFolio.folio}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){$.each(n,function(n,t){t.Estado?($("#tagsSaver").append('<input type="checkbox" class="categorias" value="'+t.CategoriaId+'" checked="true"/><small> '+t.Nombre+"<\/small><br/>"),objCategorias.seleccionadas.push(parseInt(t.CategoriaId))):$("#tagsSaver").append('<input type="checkbox" class="categorias" value="'+t.CategoriaId+'"/><small> '+t.Nombre+"<\/small><br/>")});$("#RevisarDocumento_Categorias").val(objCategorias.seleccionadas.join(","));SeleccionCategoria()}})}function SeleccionCategoria(){$("#tagsSaver input[type=checkbox]").on("change",function(){objCategorias.seleccionadas=[];$("#tagsSaver input[type=checkbox]:checked").length===0&&$("input#catGeneral").prop("checked",!0);$("#tagsSaver input[type=checkbox]:checked").each(function(){objCategorias.seleccionadas.push(parseInt($(this).val()))});$("#RevisarDocumento_Categorias").val(objCategorias.seleccionadas.join(","))})}function LecturaCategorias(){objCategorias.seleccionadas=[];objCategorias.urln=objWebRoot.route+"api/v1/categorias/seleccionadas";$.ajax({url:objCategorias.urln,type:"POST",data:JSON.stringify({Usuario:objUser.username,Folio:objFolio.folio}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){$.each(n,function(n,t){t.Estado&&($("#tagsSaver").append('<span class="ml-1 badge badge-light">'+t.Nombre+"<\/span>"),objCategorias.seleccionadas.push(parseInt(t.CategoriaId)))});$("#RevisarDocumento_Categorias").val(objCategorias.seleccionadas.join(","))}})}function ControlArchivos(){objArchivosTemp.urlnCargar=objWebRoot.route+"api/v1/anexos/subir/archivo/temporal/"+objUser.usersession;objArchivosTemp.urlnEliminar=objWebRoot.route+"api/v1/anexos/borrar/archivo/temporal";var n={url:objArchivosTemp.urlnCargar,acceptedFiles:objExtensiones.valores,dictDefaultMessage:"Arraste sus archivos aquí o haga clic para abrir el explorador",dictFallbackMessage:"Su navegador no admite la carga de archivos por medio de arrastrar y soltar.",dictFallbackText:"Utilice el formulario de reserva para cargar sus archivos como en los viejos tiempos.",dictFileTooBig:"El archivo es demasiado grande ({{filesize}}MiB). Tamaño máximo de archivo: {{maxFilesize}}MiB.",dictInvalidFileType:"No puedes subir archivos de este tipo.",dictResponseError:"El servidor respondió con el código {{statusCode}}.",dictCancelUpload:"Cancelar carga",dictCancelUploadConfirmation:"¿Estás seguro de que deseas cancelar esta carga?",dictRemoveFile:"Remover archivo",dictMaxFilesExceeded:"No puedes subir más archivos.",dictRemoveFile:"x",createImageThumbnails:!0,addRemoveLinks:!0,maxFiles:10,maxFilesize:25,success:function(n,t){if(t.trim().length>0)$.inArray(t,objArchivosTemp.listado)===-1&&(objArchivosTemp.listado.push(t),objArchivosTemp.cadena="",$.each(objArchivosTemp.listado,function(n,t){objArchivosTemp.cadena=objArchivosTemp.cadena+t;n+1<objArchivosTemp.listado.length&&(objArchivosTemp.cadena=objArchivosTemp.cadena+",")}),$("#RevisarDocumento_Anexos").val(objArchivosTemp.cadena));else{this.removeFile(n);var i=n.previewElement;i!==null?i.parentNode.removeChild(n.previewElement):void 0}},renameFile:function(n){var t=n.name;t.includes(",")&&(t=t.replace(/,/g,"-"));let i=t;return n.newName=i,i},error:function(n,t){alert(t);this.removeFile(n);var i=n.previewElement;i!==null?i.parentNode.removeChild(n.previewElement):void 0},removedfile:function(n){$.ajax({url:objArchivosTemp.urlnEliminar,type:"POST",data:JSON.stringify({Folio:objUser.usersession,NombreArchivo:n.name}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(t){if(t.trim().length>0){objArchivosTemp.indice=$.inArray(t,objArchivosTemp.listado);objArchivosTemp.indice>-1&&objArchivosTemp.listado.splice(objArchivosTemp.indice,1);objArchivosTemp.cadena="";$.each(objArchivosTemp.listado,function(n,t){objArchivosTemp.cadena=objArchivosTemp.cadena+t;n+1<objArchivosTemp.listado.length&&(objArchivosTemp.cadena=objArchivosTemp.cadena+",")});$("#RevisarDocumento_Anexos").val(objArchivosTemp.cadena);var i=n.previewElement;return i!==null?i.parentNode.removeChild(n.previewElement):void 0}}})},headers:{Authorization:"Bearer "+objWebRoot.token}};$("#uploader").dropzone(n)}function CargaArchivos(){objListadoArchivos.urln=objWebRoot.route+"api/v1/anexos/descarga/archivos/documento";objListadoArchivos.datos=Object.keys({});$.ajax({url:objListadoArchivos.urln,type:"POST",data:JSON.stringify({Folio:objFolio.folio}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){if(n!==""){objListadoArchivos.datos=Object.keys({});objListadoArchivos.datos=n;$.each(objListadoArchivos.datos,function(n,t){$("#containerArchivos").append($('<span class="tm-tag cm-tag"><a class="cmt-titulo" href="'+objWebRoot.route+t.Ruta+'" download>'+t.Nombre+'<\/a><span class="cmt-eliminar tm-tag-remove btn btn-sm pt-0 pr-0 pb-0">x<\/span><\/span>'))});$(".cm-tag").on("click",".cmt-eliminar",function(){objEliminarArchivo.seleccion=null;objEliminarArchivo.seleccion=$(this);eliminaAnexo(objEliminarArchivo.seleccion.siblings("a").text());$.when(objEliminarArchivo.bandera).done(function(){objEliminarArchivo.estado&&objEliminarArchivo.seleccion.parent().remove();objEliminarArchivo.bandera=null})})}}})}function eliminaAnexo(n){objEliminarArchivo.urln=objWebRoot.route+"api/v1/anexos/borrar/archivo/documento";objEliminarArchivo.bandera=$.ajax({url:objEliminarArchivo.urln,type:"POST",data:JSON.stringify({Folio:objFolio.folio,NombreArchivo:n}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){objEliminarArchivo.estado=n.trim().length>0?!0:!1},error:function(){objEliminarArchivo.estado=!1}})}function LecturaArchivos(){objListadoArchivos.urln=objWebRoot.route+"api/v1/anexos/descarga/archivos/documento";$.ajax({url:objListadoArchivos.urln,type:"POST",data:JSON.stringify({Folio:objFolio.folio}),datatype:"application/json",contentType:"application/json",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},success:function(n){n!==""&&(objListadoArchivos.datos=Object.keys({}),objListadoArchivos.datos=n,$.each(objListadoArchivos.datos,function(n,t){$("#containerArchivos").append($('<span class="tm-tag cm-tag"><a class="cmt-titulo" href="'+objWebRoot.route+t.Ruta+'" download>'+t.Nombre+"<\/a><\/span>"))}))}})}var objUser={username:"",usersession:""},objWebRoot={route:"",token:""},objDelegar={estadoDelegar:!1},objVisualizaRevision={remitente:1,destinatario:2,actual:0},objEstadoRemitente={estado1:1,estado2:2,actual:0},objEstadoDestinatario={estado1:3,estado2:4,actual:0},objExtensiones={valores:""},objFolio={folio:""},objTipoDocumento={oficio:1,memorandum:2,seleccionado:0},objEditor={froala:null},objPlantilla,objCategorias,objArchivosTemp,objListadoArchivos,objEliminarArchivo;$(function(){objWebRoot.route=$("#routeWebRoot").val();objWebRoot.token=$("#TokenWebApi").val();objUser.username=$("#user").text();objUser.usersession=$("#RevisarDocumento_FolioSession").val();objExtensiones.valores=$("#RevisarDocumento_Extensiones").val();objFolio.folio=$("#folioInput").val();objVisualizaRevision.actual=parseInt($("#RevisarDocumento_TipoVisualizacion").val());objEstadoRemitente.actual=parseInt($("#RevisarDocumento_EstadoRemitente").val());objEstadoDestinatario.actual=parseInt($("#RevisarDocumento_EstadoDestinatario").val());objDelegar.estadoDelegar=$("#EstadoDelegar").val()==="True";objVisualizaRevision.actual===objVisualizaRevision.remitente?objEstadoRemitente.actual===objEstadoRemitente.estado1?(LecturaCategorias(),LecturaArchivos(),LecturaTipoDocumento()):objEstadoRemitente.actual===objEstadoRemitente.estado2&&($("#contiene-cuerpo").removeClass("d-none"),objDelegar.estadoDelegar?(objEditor.froala=new FroalaEditor("#RevisarDocumento_Cuerpo",{key:"UBB7jE6D5G3I3A2A6aIVLEABVAYFKc1Ce1MYGD1c1NYVMiB3B9B6B5C2B4C3H3I3I3==",toolbarButtons:["fullscreen","bold","italic","textColor","fontSize","underline","subscript","superscript","|","align","formatOL","formatUL","outdent","indent","|","insertLink","insertTable","|","clearFormatting","selectAll","|","undo","redo"],colorsText:["#000000","#2E64FE","#088A29","#FF0000","#585858","#FFFF00","#8A084B"],attribution:!1,language:"es",heightMin:300,heightMax:400,theme:"gray",placeholderText:"Escriba su documento",wordPasteModal:!0,pastePlain:!0,wordDeniedAttrs:["style","width","height"],quickInsertTags:[""],imageMaxSize:3145728,fontSizeSelection:!0,fontSize:["8","10","12","14","18"],fontSizeDefaultSelection:"16",listAdvancedTypes:!1,imageUploadURL:objWebRoot.route+"api/v1/CargaImagenes/"+objUser.username+"/"+objFolio.folio,requestHeaders:{Authorization:"Bearer "+objWebRoot.token},events:{"image.removed":function(n){$.ajax({method:"POST",url:objWebRoot.route+"api/v1/EliminaImagenes",beforeSend:function(n){n.setRequestHeader("Authorization","Bearer "+objWebRoot.token)},data:{src:n.attr("src")}}).done(function(){console.log("Image was deleted")}).fail(function(n){console.log("Image delete problem: "+JSON.stringify(n))})}}}),GetCategorias(),ControlArchivos(),CargaArchivos(),ControlPlantilla(),ControlTipoDocumento()):(LecturaCategorias(),LecturaArchivos(),LecturaTipoDocumento())):objVisualizaRevision.actual===objVisualizaRevision.destinatario&&($("#contiene-cuerpo").removeClass("d-none"),objDelegar.estadoDelegar?(objEditor.froala=new FroalaEditor("#RevisarDocumento_Cuerpo",{key:"UBB7jE6D5G3I3A2A6aIVLEABVAYFKc1Ce1MYGD1c1NYVMiB3B9B6B5C2B4C3H3I3I3==",toolbarButtons:["fullscreen","bold","italic","textColor","underline","strikeThrough","subscript","superscript","|","align","formatOL","formatUL","outdent","indent","|","insertLink","insertTable","|","insertHR","clearFormatting","selectAll","|","undo","redo"],colorsText:["#000000","#2E64FE","#088A29","#FF0000","#585858","#FFFF00","#8A084B"],language:"es",heightMin:300,heightMax:400,theme:"gray",placeholderText:"Escriba su documento",wordPasteModal:!0,pastePlain:!0,wordDeniedAttrs:["style","width","height"],quickInsertTags:[""],videoUpload:!1,imageUpload:!0,imageMaxSize:3145728,fontSizeSelection:!0,fontSize:["8","10","12","14","18"],fontSizeDefaultSelection:"16",listAdvancedTypes:!1,imageUploadURL:objWebRoot.route+"api/v1/CargaImagenes/"+objUser.username+"/"+objFolio.folio,requestHeaders:{Authorization:"Bearer "+objWebRoot.token}}),GetCategorias(),ControlArchivos(),CargaArchivos(),ControlPlantilla(),LecturaTipoDocumento()):(LecturaCategorias(),LecturaArchivos(),LecturaTipoDocumento()))});objPlantilla={urln:"",nombre:""};objCategorias={urln:"",seleccionadas:[]};objArchivosTemp={listado:[],cadena:"",indice:0,urlnCargar:"",urlnEliminar:""};Dropzone.autoDiscover=!1;objListadoArchivos={urln:"",datos:Object.keys({})};objEliminarArchivo={urln:"",estado:!1,bandera:null,seleccion:null};