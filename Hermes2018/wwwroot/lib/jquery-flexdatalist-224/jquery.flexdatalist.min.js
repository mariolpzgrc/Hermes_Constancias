jQuery.fn.flexdatalist=function(n,t){"use strict";var u=function(n,t){n.each(function(){var i=$(this),r=i.data(),n=r.flexdatalist,u=r.aliascontainer;u&&(i.removeClass("flexdatalist-set").attr({style:null,tabindex:null}).val(n&&n.originalValue&&!t?n.originalValue:"").removeData("flexdatalist").removeData("aliascontainer").off(),u.remove())})},i,r;if(typeof n=="string"&&n!=="reset"){if(typeof this[0].fvalue!="undefined"){if(i=this[0],n==="destroy")u(this,t);else if(n==="value"){if(typeof t=="undefined")return i.fvalue.get();i.fvalue.set(t)}else if(n==="add"){if(typeof t=="undefined")return i.debug("Missing value to add!");i.fvalue.add(t)}else if(n==="toggle"){if(typeof t=="undefined")return i.debug("Missing value to toggle!");i.fvalue.toggle(t)}else if(n==="remove"){if(typeof t=="undefined")return i.debug("Missing value to remove!");i.fvalue.remove(t)}else if(n==="disabled"){if(typeof t=="undefined")return i.fdisabled();i.fdisabled(t)}else if(typeof n=="string"){if(typeof t=="undefined")return i.options.get(n);i.options.set(n,t)}return this}n={_option:t}}return this.length>0&&typeof this[0].fvalue!="undefined"&&u(this),r=$.extend({url:null,data:[],params:{},relatives:null,chainedRelatives:!1,cache:!0,cacheLifetime:60,minLength:2,groupBy:!1,selectionRequired:!1,focusFirstResult:!1,textProperty:null,valueProperty:null,visibleProperties:[],iconProperty:"thumb",searchIn:["label"],searchContain:!1,searchEqual:!1,searchByWord:!1,searchDisabled:!1,searchDelay:300,normalizeString:null,multiple:null,disabled:null,maxShownResults:100,removeOnBackspace:!0,noResultsText:'No results found for "{keyword}"',toggleSelected:!1,allowDuplicateValues:!1,redoSearchOnFocus:!0,requestType:"get",requestContentType:"x-www-form-urlencoded",resultsProperty:"results",keywordParamName:"keyword",limitOfValues:0,valuesSeparator:",",debug:!0,headers:{}},n),this.each(function(n){var i=$(this),t=this,s=null,e=[],o="flex"+n,u=null,f=null;this.init=function(){var n=this.options.init();this.set.up();u.on("focusin",function(n){t.action.redoSearchFocus(n);t.action.showAllResults(n);f&&f.addClass("focus")}).on("input keydown",function(n){t.keyNum(n)===9&&t.results.remove();t.action.keypressValue(n,188);t.action.backSpaceKeyRemove(n)}).on("input keyup",function(n){t.action.keypressValue(n,13);t.action.keypressSearch(n);t.action.copyValue(n);t.action.backSpaceKeyRemove(n);t.action.showAllResults(n);t.action.clearValue(n);t.action.removeResults(n);t.action.inputWidth(n)}).on("focusout",function(n){f&&f.removeClass("focus");t.action.clearText(n);t.action.clearValue(n)});window.onresize=function(){t.position()};this.cache.gc();n.selectionRequired&&t.fvalue.clear(!0,!0);this.fvalue._load(n.originalValue,function(){t.fdisabled(n.disabled);i.trigger("init:flexdatalist",[n])},!0)};this.action={keypressValue:function(n,i){var e=t.keyNum(n),r=u[0].value,f=t.options.get();r.length>0&&e===i&&!f.selectionRequired&&f.multiple&&(r=u[0].value,n.preventDefault(),t.fvalue.extract(r),t.results.remove())},keypressSearch:function(n){var i=t.keyNum(n),f=u.val(),e=f.length,r=t.options.get();clearTimeout(s);(!i||i!==13&&(i<37||i>40))&&(s=setTimeout(function(){(r.minLength===0&&e>0||r.minLength>0&&e>=r.minLength)&&t.data.load(function(n){t.search.get(f,n,function(n){t.results.show(n)})})},r.searchDelay))},redoSearchFocus:function(n){var f=t.fvalue.get(),i=t.options.get(),r=u.val();i.redoSearchOnFocus&&(r.length>0&&i.multiple||r.length>0&&f.length===0)&&this.keypressSearch(n)},copyValue:function(n){if(t.keyNum(n)!==13){var i=u.val(),f=t.fvalue.get(!0),r=t.options.get();r.multiple||r.selectionRequired||i.length===f.length||t.fvalue.extract(i)}},backSpaceKeyRemove:function(n){var r=t.options.get(),f,i;r.removeOnBackspace&&r.multiple&&(f=u.val(),i=u.data("_remove"),t.keyNum(n)===8&&(f.length===0?i?(t.fvalue.remove(i),u.data("_remove",null)):u.data("_remove",u.parents("li:eq(0)").prev()):u.data("_remove",null)))},showAllResults:function(){var n=u.val();n=$.trim(n);n===""&&t.options.get("minLength")===0&&t.data.load(function(n){t.results.show(n)})},inputWidth:function(){var r=t.options.get();if(r.multiple){var f=u.val(),e=parseInt(u.css("fontSize").replace("px","")),o=i.innerWidth(),n=(f.length+1)*e;n>=40&&n<=o&&(u[0].style.width=n+"px")}},clearText:function(){var i=t.fvalue.get(),n=t.options.get();!n.multiple&&n.selectionRequired&&i.length===0&&(u[0].value="")},clearValue:function(){var r=t.fvalue.get(),i=u.val(),n=t.options.get();!n.multiple&&n.selectionRequired&&i.length<=n.minLength&&t.fvalue.clear()},removeResults:function(){var r=t.fvalue.get(),i=u.val(),n=t.options.get();n.minLength>0&&i.length<n.minLength&&t.results.remove()}};this.set={up:function(){u=this.alias();t.options.get("multiple")?f=this.multipleInput(u):u.insertAfter(i);i.attr("autofocus")&&u.focus();i.data("aliascontainer",f?f:u).addClass("flexdatalist flexdatalist-set").css({position:"absolute",top:-14e3,left:-14e3}).attr("tabindex",-1);var n=i.attr("id"),r=u.attr("id");$('label[for="'+n+'"]').attr("for",r);this.chained()},alias:function(){var n=i.attr("id")?i.attr("id")+"-flexdatalist":o;return $('<input type="text">').attr({"class":i.attr("class"),name:i.attr("name")?"flexdatalist-"+i.attr("name"):null,id:n,placeholder:i.attr("placeholder")}).addClass("flexdatalist-alias "+n).removeClass("flexdatalist").attr("autocomplete","off")},multipleInput:function(n){return f=$('<ul tabindex="1">').addClass("flexdatalist-multiple "+o).css({"border-color":i.css("border-left-color"),"border-width":i.css("border-left-width"),"border-style":i.css("border-left-style"),"border-radius":i.css("border-top-left-radius"),"background-color":i.css("background-color")}).insertAfter(i).click(function(){$(this).find("input").focus()}),$('<li class="input-container">').addClass("flexdatalist-multiple-value").append(n).appendTo(f),f},chained:function(){var n=t.options.get(),i;if(n.relatives&&n.chainedRelatives){i=function(){n.relatives.each(function(){var n=t.isEmpty($(this).val()),i=t.isEmpty(t.value);(n||!i)&&t.fvalue.clear();t.fdisabled(n)})};n.relatives.on("change",function(){i()});i(!0)}}};this.fvalue={get:function(n){var i=t.value,r=t.options.get();return(r.multiple||this.isJSON())&&!n?this.toObj(i):i},set:function(n,r){return t.fdisabled()||(r||this.clear(!0),this._load(n)),i},add:function(n){return t.options.get("multiple")&&this.set(n,!0),this},toggle:function(n){return t.fdisabled()||this.multiple.toggle(n),this},remove:function(n){var r,u;return t.fdisabled()||(n=this.toObj(n),i.trigger("before:flexdatalist.remove",[n]),r=[],$.isArray(n)?$.each(n,function(n,i){var u=t.fvalue.multiple.remove(i);u&&r.push(u)}):(u=this.multiple.remove(n),u&&r.push(u)),i.trigger("after:flexdatalist.remove",[n,r]).trigger("change:flexdatalist",[r,t.options.get()]).trigger("change")),this},_load:function(n,i,r){var f=t.options.get(),u=f.valueProperty,e=this.toStr(n),o=this.get(!0);if(i=i?i:$.noop,e.length==0&&o.length==0){i(n);return}if(n=this.toObj(n),!t.isEmpty(n)&&!t.isEmpty(u)&&u!=="*"){t.isObject(u)||(u=u.split(","));t.data.load(function(r){var o,s,h,c,l,e,f;for(t.isObject(n)?$.isArray(n)||(n=[n]):n=n.split(","),o=[],s=0;s<n.length;s++)for(f=n[s],h=0;h<r.length;h++)for(c=r[h],l=0;l<u.length;l++)e=u[l],f=t.isDefined(f,e)?f[e]:f,t.isDefined(c,e)&&f===c[e]&&o.push(c);o.length>0&&t.fvalue.extract(o,!0);i(n)},n);return}i(n);t.fvalue.extract(n,r)},extract:function(n,r){var f=t.options.get(),u=[];r||i.trigger("before:flexdatalist.value",[n,f]);$.isArray(n)?$.each(n,function(n,i){u.push(t.fvalue._extract(i))}):u=t.fvalue._extract(n);r||i.trigger("after:flexdatalist.value",[u,f]).trigger("change:flexdatalist",[u,f]).trigger("change")},_extract:function(n){var r=this.text(n),i=this.value(n),f=t.value,u=t.options.get();if(u.multiple){if(!t.isEmpty(i)){if(t.isDup(i))return;e.push(i);this.multiple.add(i,r)}}else this.single(i,r);return{value:i,text:r}},single:function(n,i){i&&i!==u.val()&&(u[0].value=i);t.value=n},multiple:{add:function(n,i){var r=this,f=this.li(n,i),e=t.options.get();f.click(function(){r.toggle($(this))}).find(".fdl-remove").click(function(){t.fvalue.remove($(this).parent())});this.push(n);u[0].value="";this.checkLimit()},push:function(n){var i=t.fvalue.get();n=t.fvalue.toObj(n);i.push(n);n=t.fvalue.toStr(i);t.value=n},toggle:function(n){var e=t.options.get(),r,c;if(e.toggleSelected&&(r=this.findLi(n),r)){var o=r.index(),s=r.data(),h=r.hasClass("disabled")?"enable":"disable",u=t.fvalue.get(),f=[{value:s.value,text:s.text,action:h},e];i.trigger("before:flexdatalist.toggle",f);h==="enable"?(c=r.data("value"),u.splice(o,0,c),r.removeClass("disabled")):(u.splice(o,1),r.addClass("disabled"));u=t.fvalue.toStr(u);t.value=u;i.trigger("after:flexdatalist.toggle",f).trigger("change:flexdatalist",f).trigger("change")}},remove:function(n){var i=this.findLi(n);if(i){var r=t.fvalue.get(),u=i.index(),f=i.data(),s=t.options.get(),o={value:f.value,text:f.text};return r.splice(u,1),r=t.fvalue.toStr(r),t.value=r,i.remove(),t.fvalue.multiple.checkLimit(),e.splice(u,1),o}},removeAll:function(){var n=t.fvalue.get(),r=t.options.get();i.trigger("before:flexdatalist.remove.all",[n,r]);f.find("li:not(.input-container)").remove();t.value="";e=[];i.trigger("after:flexdatalist.remove.all",[n,r])},li:function(n,i){var r=f.find("li.input-container");return $("<li>").addClass("value"+(t.options.get("toggleSelected")?" toggle":"")).append('<span class="text">'+i+"<\/span>").append('<span class="fdl-remove">&times;<\/span>').data({text:i,value:t.fvalue.toObj(n)}).insertBefore(r)},checkLimit:function(){var i=t.options.get("limitOfValues"),n,r;i>0&&(n=f.find("li.input-container"),r=e.length,i==r?n.hide():n.show())},findLi:function(n){if(n instanceof jQuery)n.length===0&&(n=null);else{var t=n;n=null;f.find("li:not(.input-container)").each(function(){var i=$(this);if(i.data("value")===t)return n=i,!1})}return n},isEmpty:function(){return this.get().length>0}},value:function(n){var u=n,f=t.options.get(),i=f.valueProperty,e,r;if(t.isObject(n))if(this.isJSON()||this.isMixed())if(delete n.name_highlight,$.isArray(i)){for(e={},r=0;r<i.length;r++)t.isDefined(n,i[r])&&(e[i[r]]=n[i[r]]);u=this.toStr(e)}else u=this.toStr(n);else u=t.isDefined(n,i)?n[i]:t.isDefined(n,f.searchIn[0])?n[f.searchIn[0]]:null;return u},text:function(n){var i=n,r=t.options.get();return t.isObject(n)&&(i=n[r.searchIn[0]],i=t.isDefined(n,r.textProperty)?n[r.textProperty]:this.placeholders.replace(n,r.textProperty,i)),$("<div>").html(i).text()},placeholders:{replace:function(n,i,r){if(t.isObject(n)&&typeof i=="string"){var u=this.parse(i);if(!t.isEmpty(n)&&u)return $.each(u,function(r,u){t.isDefined(n,u)&&(i=i.replace(r,n[u]))}),i}return r},parse:function(n){var i=n.match(/\{.+?\}/g),t;return i?(t={},i.map(function(n){t[n]=n.slice(1,-1)}),t):!1}},clear:function(n,r){var o=t.value,f=t.options.get();return f.multiple&&this.multiple.removeAll(),t.value="",o===""||r||i.trigger("change:flexdatalist",[{value:"",text:""},f]).trigger("change"),n&&(u[0].value=""),e=[],this},toObj:function(n){if(typeof n!="object"){var i=t.options.get();t.isEmpty(n)||!t.isDefined(n)?n=i.multiple?[]:this.isJSON()?{}:"":this.isCSV()?(n=n.toString().split(i.valuesSeparator),n=$.map(n,function(n){return $.trim(n)})):(this.isMixed()||this.isJSON())&&this.isJSON(n)?n=JSON.parse(n):typeof n=="number"&&(n=n.toString())}return n},toStr:function(n){return typeof n!="string"&&(t.isEmpty(n)||!t.isDefined(n)?n="":typeof n=="number"?n=n.toString():this.isCSV()?n=n.join(t.options.get("valuesSeparator")):(this.isJSON()||this.isMixed())&&(n=JSON.stringify(n))),$.trim(n)},isJSON:function(n){if(typeof n!="undefined"){if(t.isObject(n))n=JSON.stringify(n);else if(typeof n!="string")return!1;return n.indexOf("{")===0||n.indexOf("[{")===0}var r=t.options.get(),i=r.valueProperty;return t.isObject(i)||i==="*"},isMixed:function(){var n=t.options.get();return!n.selectionRequired&&n.valueProperty==="*"},isCSV:function(){return!this.isJSON()&&t.options.get("multiple")}};this.data={load:function(n,t){var u=this,r=[];i.trigger("before:flexdatalist.data");this.url(function(t){r=r.concat(t);u.static(function(t){r=r.concat(t);u.datalist(function(t){r=r.concat(t);i.trigger("after:flexdatalist.data",[r]);n(r)})})},t)},"static":function(n){var f=this,i=t.options.get(),r,u;if(typeof i.data=="string"){if(r=i.data,u=t.cache.read(r,!0),u){n(u);return}this.remote({url:r,success:function(u){i.data=u;n(u);t.cache.write(r,u,i.cacheLifetime,!0)}})}else typeof i.data!="object"&&(i.data=[]),n(i.data)},datalist:function(n){var r=i.attr("list"),u=[];t.isEmpty(r)||$("#"+r).find("option").each(function(){var n=$(this),t=n.val(),i=n.text();u.push({label:i.length>0?i:t,value:t})});n(u)},url:function(n,i){var v=this,e=u.val(),r=t.options.get(),l=r.keywordParamName,a=t.fvalue.get(),c=this.relativesData(),f,o,s,h;if(t.isEmpty(r.url))return n([]);if(f={},r.requestType==="post"&&($.each(r,function(n,t){n.indexOf("_")!=0&&n!="data"&&(f[n]=t)}),delete f.relatives),o=t.cache.keyGen({relative:c,load:i,keyword:e,contain:r.searchContain},r.url),s=t.cache.read(o,!0),s){n(s);return}h=$.extend(c,r.params,{load:i,contain:r.searchContain,selected:a,original:r.originalValue,options:f});h[l]=e;this.remote({url:r.url,data:h,success:function(i){var f=u.val();f.length>=e.length&&n(i);t.cache.write(o,i,r.cacheLifetime,!0)}})},remote:function(n){var u=this,r=t.options.get();i.hasClass("flexdatalist-loading")||(i.addClass("flexdatalist-loading"),r.requestContentType==="json"&&(n.data=JSON.stringify(n.data)),$.ajax($.extend({type:r.requestType,dataType:"json",contentType:"application/"+r.requestContentType+"; charset=UTF-8",beforeSend:function(n){n.setRequestHeader("Authorization",r.headers.Authorization)},complete:function(){i.removeClass("flexdatalist-loading")}},n,{success:function(t){t=u.extractRemoteData(t);n.success(t)}})))},extractRemoteData:function(n){var r=t.options.get(),i=t.isDefined(n,r.resultsProperty)?n[r.resultsProperty]:n;return(typeof i=="string"&&i.indexOf("[{")===0&&(i=JSON.parse(i)),i&&i.options&&t.options.set($.extend({},r,i.options)),t.isObject(i))?i:[]},relativesData:function(){var i=t.options.get("relatives"),n={};return i&&(n.relatives={},i.each(function(){var t=$(this),i=t.attr("name").split("][").join("-").split("]").join("-").split("[").join("-").replace(/^\|+|\-+$/g,"");n.relatives[i]=t.val()})),n}};this.search={get:function(n,r,u){var s=this,c=t.options.get(),f,h,o,e;if(c.searchDisabled)f=r;else if(f=t.cache.read(n),!f){if(i.trigger("before:flexdatalist.search",[n,r]),!t.isEmpty(n))for(f=[],h=s.split(n),o=0;o<r.length;o++)(e=r[o],t.isDup(e))||(e=s.matches(e,h),e&&f.push(e));t.cache.write(n,f,2);i.trigger("after:flexdatalist.search",[n,r,f])}u(f)},matches:function(n,i){var c=$.extend({},n),s=[],l=t.options.get(),a=l.searchIn,u,r,e,o;if(i.length>0)for(u=0;u<a.length;u++)if(r=a[u],t.isDefined(n,r)&&n[r]){var h=n[r].toString(),f=h,v=this.split(h);for(e=0;e<i.length;e++)o=i[e],this.find(o,v)&&(s.push(o),f=this.highlight(o,f));f!==h&&(c[r+"_highlight"]=this.highlight(f))}return s.length===0||l.searchByWord&&s.length<i.length-1?!1:c},highlight:function(n,i){return i?i.replace(new RegExp(n,t.options.get("searchContain")?"ig":"i"),"|:|$&|::|"):(n=n.split("|:|").join('<span class="highlight">'),n.split("|::|").join("<\/span>"))},find:function(n,i){for(var r,f=t.options.get(),u=0;u<i.length;u++){if(r=i[u],r=this.normalizeString(r),n=this.normalizeString(n),f.searchEqual)return r==n;if(f.searchContain?r.indexOf(n)>=0:r.indexOf(n)===0)return!0}return!1},split:function(n){var i,r,u;if(typeof n=="string"&&(n=[$.trim(n)]),t.options.get("searchByWord"))for(i=0;i<n.length;i++)r=$.trim(n[i]),r.indexOf(" ")>0&&(u=r.split(" "),$.merge(n,u));return n},normalizeString:function(n){if(typeof n=="string"){var i=t.options.get("normalizeString");return typeof i=="function"&&(n=i(n)),n.toUpperCase()}return n}};this.results={show:function(n){var e=this,r=t.options.get(),u,f;if(this.remove(!0),n){if(n.length===0){this.empty(r.noResultsText);return}}else return;u=this.container();r.groupBy?(n=this.group(n),Object.keys(n).forEach(function(i){var f=n[i],o=r.groupBy,s=t.results.highlight(f[0],o,i),h=$("<li>").addClass("group").append($("<span>").addClass("group-name").html(s)).append($("<span>").addClass("group-item-count").text(" "+f.length)).appendTo(u);e.items(f,u)})):this.items(n,u);f=u.find("li:not(.group)");f.on("click",function(){var n=$(this).data("item");n&&(t.fvalue.extract(n),e.remove(),i.trigger("select:flexdatalist",[n,r]))}).hover(function(){f.removeClass("active");$(this).addClass("active").trigger("active:flexdatalist.results",[$(this).data("item")])},function(){$(this).removeClass("active")});r.focusFirstResult&&f.filter(":first").addClass("active")},empty:function(n){if(!t.isEmpty(n)){var i=this.container(),r=u.val();n=n.split("{keyword}").join(r);$("<li>").addClass("item no-results").append(n).appendTo(i)}},items:function(n,r){var f=t.options.get("maxShownResults"),u;for(i.trigger("show:flexdatalist.results",[n]),u=0;u<n.length;u++){if(f>0&&f===u)break;this.item(n[u]).appendTo(r)}i.trigger("shown:flexdatalist.results",[n])},item:function(n){for(var i,s,h,r,c,f=$("<li>").data("item",n).addClass("item"),u=t.options.get(),o=u.visibleProperties,e=0;e<o.length;e++){if(i=o[e],i.indexOf("{")>-1)s=t.fvalue.placeholders.replace(n,i),h=t.fvalue.placeholders.parse(i),r=$("<span>").addClass("item item-"+Object.values(h).join("-")).html(s+" ").appendTo(f);else{if(u.groupBy&&u.groupBy===i||!t.isDefined(n,i))continue;r={};i===u.iconProperty?r=$("<img>").addClass("item item-"+i).attr("src",n[i]):(c=t.results.highlight(n,i),r=$("<span>").addClass("item item-"+i).html(c+" "))}r.appendTo(f)}return f},container:function(){var n=i,r;return f&&(n=f),r=$("ul.flexdatalist-results"),r.length===0&&(r=$("<ul>").addClass("flexdatalist-results ").appendTo("body").attr("id",u.attr("id")+"-results").css({"border-color":n.css("border-left-color"),"border-width":"1px","border-bottom-left-radius":n.css("border-bottom-left-radius"),"border-bottom-right-radius":n.css("border-bottom-right-radius")}).data({target:f?f:u,input:i}),t.position(u)),r},group:function(n){for(var r,u,i=[],e=t.options.get("groupBy"),f=0;f<n.length;f++)r=n[f],t.isDefined(r,e)&&(u=r[e],t.isDefined(i,u)||(i[u]=[]),i[u].push(r));return i},highlight:function(n,i,r){return t.isDefined(n,i+"_highlight")?n[i+"_highlight"]:t.isDefined(n,i)?n[i]:r},remove:function(n){var t="ul.flexdatalist-results";n&&(t="ul.flexdatalist-results li");i.trigger("remove:flexdatalist.results");$(t).remove();i.trigger("removed:flexdatalist.results")}};this.cache={write:function(n,i,r,u){if(t.cache.isSupported()){n=this.keyGen(n,undefined,u);var f={value:i,timestamp:t.unixtime(),lifetime:r?r:!1};localStorage.setItem(n,JSON.stringify(f))}},read:function(n,i){var r,u;if(t.cache.isSupported()&&(n=this.keyGen(n,undefined,i),r=localStorage.getItem(n),r)){if(u=JSON.parse(r),!this.expired(u))return u.value;localStorage.removeItem(n)}return null},"delete":function(n,i){t.cache.isSupported()&&(n=this.keyGen(n,undefined,i),localStorage.removeItem(n))},clear:function(){if(t.cache.isSupported()){for(var n in localStorage)(n.indexOf(o)>-1||n.indexOf("global")>-1)&&localStorage.removeItem(n);localStorage.clear()}},gc:function(){var n,i;if(t.cache.isSupported())for(n in localStorage)(n.indexOf(o)>-1||n.indexOf("global")>-1)&&(i=localStorage.getItem(n),i=JSON.parse(i),this.expired(i)&&localStorage.removeItem(n))},isSupported:function(){if(t.options.get("cache"))try{return"localStorage"in window&&window.localStorage!==null}catch(n){return!1}return!1},expired:function(n){if(n.lifetime){var i=t.unixtime()-n.timestamp;return n.lifetime<=i}return!1},keyGen:function(n,t,i){typeof n=="object"&&(n=JSON.stringify(n));for(var r=t===undefined?2166136261:t,u=0,f=n.length;u<f;u++)r^=n.charCodeAt(u),r+=(r<<1)+(r<<4)+(r<<7)+(r<<8)+(r<<24);return(i?"global":o)+("0000000"+(r>>>0).toString(16)).substr(-8)}};this.options={init:function(){var n=$.extend({},r,i.data(),{multiple:r.multiple===null?i.is("[multiple]"):r.multiple,disabled:r.disabled===null?i.is("[disabled]"):r.disabled,originalValue:t.value});return this.set(n),n},get:function(n){var r=i.data("flexdatalist");return n?t.isDefined(r,n)?r[n]:null:r?r:{}},set:function(n,r){var u=this.get();return t.isDefined(u,n)&&t.isDefined(r)?u[n]=r:t.isObject(n)&&(u=this._normalize(n)),i.data("flexdatalist",u),i},_normalize:function(n){if(n.searchIn=t.csvToArray(n.searchIn),n.relatives=n.relatives&&$(n.relatives).length>0?$(n.relatives):null,n.textProperty=n.textProperty===null?n.searchIn[0]:n.textProperty,n.visibleProperties=t.csvToArray(n.visibleProperties,n.searchIn),n.valueProperty==="*"&&n.multiple&&!n.selectionRequired)throw new Error("Selection must be required for multiple, JSON fields!");return n}};this.position=function(){var t=$("ul.flexdatalist-results"),n=t.data("target");t.length>0&&t.css({width:n.outerWidth()+"px",top:n.offset().top+n.outerHeight()+"px",left:n.offset().left+"px"})};this.fdisabled=function(n){if(this.isDefined(n)){if(i.prop("disabled",n),u.prop("disabled",n),f){f.css("background-color",i.css("background-color"));var t=f.find("li .fdl-remove"),r=f.find("li.input-container");n?(f.addClass("disabled"),t.length>0&&r.hide(),t.hide()):(f.removeClass("disabled"),r.show(),t.show())}this.options.set("disabled",n)}return this.options.get("disabled")};this.isDup=function(n){return this.options.get("allowDuplicateValues")?!1:e.length>0&&e.indexOf(this.fvalue.value(n))>-1};this.keyNum=function(n){return n.which||n.keyCode};this.isEmpty=function(n){if(t.isDefined(n)){if(n===null)return!0;if(n===!0)return!1;if(this.length(n)===0||$.trim(n)==="")return!0}else return!0;return!1};this.isObject=function(n){return n&&typeof n=="object"};this.length=function(n){return this.isObject(n)?Object.keys(n).length:typeof n=="number"||typeof n.length=="number"?n.toString().length:0};this.isDefined=function(n,t){var i=typeof n!="undefined";return i&&typeof t!="undefined"?typeof n[t]!="undefined":i};this.unixtime=function(n){var t=new Date;return n&&(t=new Date(n)),Math.round(t.getTime()/1e3)};this.csvToArray=function(n,i){return n.length===0?i:typeof n=="string"?n.split(t.options.get("valuesSeparator")):n};this.debug=function(n,r){var u=t.options.get();u.debug&&(r||(r={}),n="Flexdatalist: "+n,console.warn(n),console.log($.extend({inputName:i.attr("name"),options:u},r)),console.log("--- /flexdatalist ---"))};this.init()})};jQuery(function(n){var t=n(document);t.data("flexdatalist")||n(document).mouseup(function(t){var i=n(".flexdatalist-results"),r=i.data("target");r&&r.is(":focus")||i.is(t.target)||i.has(t.target).length!==0||i.remove()}).keydown(function(t){var u=n(".flexdatalist-results"),f=u.find("li"),i=f.filter(".active"),e=i.index(),o=f.length,r=t.which||t.keyCode,s;if(o!==0){if(r===27){u.remove();return}r===13?(t.preventDefault(),i.click()):(r===40||r===38)&&(t.preventDefault(),r===40?i=e<o&&i.nextAll(".item").first().length>0?i.removeClass("active").nextAll(".item").first().addClass("active"):f.removeClass("active").filter(".item:first").addClass("active"):r===38&&(i=e>0&&i.prevAll(".item").first().length>0?i.removeClass("active").prevAll(".item").first().addClass("active"):f.removeClass("active").filter(".item:last").addClass("active")),i.trigger("active:flexdatalist.results",[i.data("item")]),s=(i.prev().length===0?i:i.prev()).position().top,u.animate({scrollTop:s+u.scrollTop()},100))}}).data("flexdatalist",!0);jQuery("input.flexdatalist:not(.flexdatalist-set):not(.autodiscover-disabled)").flexdatalist()}),function(n){var t=n.fn.val;n.fn.val=function(n){var i=this.length>0&&typeof this[0].fvalue!="undefined";return typeof n=="undefined"?i?this[0].fvalue.get(!0):t.call(this):i?this[0].fvalue.set(n):t.call(this,n)}}(jQuery);