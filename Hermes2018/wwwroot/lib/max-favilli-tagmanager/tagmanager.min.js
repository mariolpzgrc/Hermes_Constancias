(function(n){"use strict";var r={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,externalTagId:!1,prefillIdFieldName:"Id",prefillValueFieldName:"Value",AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1,tagList:null,fillInputOnTagRemove:!1,AjaxPushDataType:"json"},i={pushTag:function(i,r,u,f){var o=n(this),e=o.data("opts"),p,g,l,s,w=o.data("tlis"),h=o.data("tlid"),v,nt,b,tt,a,c,rt,y,ut,k,d,it;if((i=t.trimTag(i,e.delimiterChars),i&&!(i.length<=0))&&(!e.onlyTagList||undefined===e.tagList||!e.tagList||(y=e.tagList,n.each(y,function(n,t){y[n]=t.toLowerCase()}),ut=n.inArray(i.toLowerCase(),y),-1!==ut))){if(e.CapitalizeFirstLetter&&i.length>1&&(i=i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()),!f&&e.validator&&!e.validator(i)){o.trigger("tm:invalid",i);return}if(!(e.maxTags>0)||!(w.length>=e.maxTags)){if(p=!1,g=jQuery.map(w,function(n){return n.toLowerCase()}),v=n.inArray(i.toLowerCase(),g),-1!==v&&(p=!0),p)if(o.trigger("tm:duplicated",i),e.blinkClass)for(k=0;k<6;++k)n("#"+o.data("tm_rndid")+"_"+h[v]).queue(function(t){n(this).toggleClass(e.blinkClass);t()}).delay(100);else n("#"+o.data("tm_rndid")+"_"+h[v]).stop().animate({backgroundColor:e.blinkBGColor_1},100).animate({backgroundColor:e.blinkBGColor_2},100).animate({backgroundColor:e.blinkBGColor_1},100).animate({backgroundColor:e.blinkBGColor_2},100).animate({backgroundColor:e.blinkBGColor_1},100).animate({backgroundColor:e.blinkBGColor_2},100);else{e.externalTagId===!0?(u===undefined&&n.error("externalTagId is not passed for tag -"+i),s=u):(l=Math.max.apply(null,h),l=l===-Infinity?0:l,s=++l);r||o.trigger("tm:pushing",[i,s]);w.push(i);h.push(s);r||e.AjaxPush!==null&&e.AjaxPushAllTags==null&&n.inArray(i,e.prefilled)===-1&&n.post(e.AjaxPush,n.extend({tag:i},e.AjaxPushParameters),null,e.AjaxPushDataType);nt=o.data("tm_rndid")+"_"+s;b=o.data("tm_rndid")+"_Remover_"+s;tt=n("<span/>").text(i).html();a='<span class="'+t.tagClasses.call(o)+'" id="'+nt+'">';a+="<span>"+tt+"<\/span>";a+='<a href="#" class="tm-tag-remove" id="'+b+'" TagIdToRemove="'+s+'">';a+=e.tagCloseIcon+"<\/a><\/span> ";c=n(a);d=o.parents(".twitter-typeahead")[0]!==undefined;e.tagsContainer!==null?n(e.tagsContainer).append(c):h.length>1?d?(it=o.data("tm_rndid")+"_"+--s,jQuery("#"+it).after(c)):(rt=o.siblings("#"+o.data("tm_rndid")+"_"+h[h.length-2]),rt.after(c)):d?o.parents(".twitter-typeahead").before(c):o.before(c);c.find("#"+b).on("click",o,function(i){i.preventDefault();var r=parseInt(n(this).attr("TagIdToRemove"));t.spliceTag.call(o,r,i.data)});t.refreshHiddenTagList.call(o);r||o.trigger("tm:pushed",[i,s]);t.showOrHide.call(o)}o.val("")}}},popTag:function(){var i=n(this),r,u,f=i.data("tlis"),e=i.data("tlid");e.length>0&&(r=e.pop(),u=f[f.length-1],i.trigger("tm:popping",[u,r]),f.pop(),n("#"+i.data("tm_rndid")+"_"+r).remove(),t.refreshHiddenTagList.call(i),i.trigger("tm:popped",[u,r]),t.showOrHide.call(i))},empty:function(){for(var i=n(this),f=i.data("tlis"),r=i.data("tlid"),u;r.length>0;)u=r.pop(),f.pop(),n("#"+i.data("tm_rndid")+"_"+u).remove(),t.refreshHiddenTagList.call(i);i.trigger("tm:emptied",null);t.showOrHide.call(i)},tags:function(){var n=this;return n.data("tlis")}},t={showOrHide:function(){var n=this,t=n.data("opts"),i=n.data("tlis");t.maxTags>0&&i.length<t.maxTags&&(n.show(),n.trigger("tm:show"));t.maxTags>0&&i.length>=t.maxTags&&(n.hide(),n.trigger("tm:hide"))},tagClasses:function(){var i=n(this),t=i.data("opts"),u=t.tagBaseClass,f=t.inputBaseClass,r;return r=u,i.attr("class")&&n.each(i.attr("class").split(" "),function(n,t){t.indexOf(f+"-")!==-1&&(r+=" "+u+t.substring(f.length))}),r+=t.tagClass?" "+t.tagClass:""},trimTag:function(t,i){var r;for(t=n.trim(t),r=0,r;r<t.length;r++)if(n.inArray(t.charCodeAt(r),i)!==-1)break;return t.substring(0,r)},refreshHiddenTagList:function(){var t=n(this),i=t.data("tlis"),r=t.data("lhiddenTagList");r&&n(r).val(i.join(t.data("opts").baseDelimiter)).change();t.trigger("tm:refresh",i.join(t.data("opts").baseDelimiter))},killEvent:function(n){n.cancelBubble=!0;n.returnValue=!1;n.stopPropagation();n.preventDefault()},keyInArray:function(t,i){return n.inArray(t.which,i)!==-1},applyDelimiter:function(t){var r=n(this);i.pushTag.call(r,n(this).val());t.preventDefault()},prefill:function(t){var r=n(this),u=r.data("opts");n.each(t,function(n,t){u.externalTagId===!0?i.pushTag.call(r,t[u.prefillValueFieldName],!0,t[u.prefillIdFieldName],!0):i.pushTag.call(r,t,!0,!1,!0)})},pushAllTags:function(t,i){var u=n(this),r=u.data("opts"),f=u.data("tlis");r.AjaxPushAllTags&&(t.type!=="tm:pushed"||n.inArray(i,r.prefilled)===-1)&&n.post(r.AjaxPush,n.extend({tags:f.join(r.baseDelimiter)},r.AjaxPushParameters))},spliceTag:function(i){var r=this,e=r.data("tlis"),o=r.data("tlid"),u=n.inArray(i,o),f;-1!==u&&(f=e[u],r.trigger("tm:splicing",[f,i]),n("#"+r.data("tm_rndid")+"_"+i).remove(),e.splice(u,1),o.splice(u,1),t.refreshHiddenTagList.call(r),r.trigger("tm:spliced",[f,i]));t.showOrHide.call(r)},init:function(u){var f=n.extend({},r,u),e,o;return f.hiddenTagListName=f.hiddenTagListName===null?"hidden-"+this.attr("name"):f.hiddenTagListName,e=f.delimeters||f.delimiters,o=[9,13,17,18,19,37,38,39,40],f.delimiterChars=[],f.delimiterKeys=[],n.each(e,function(t,i){n.inArray(i,o)!==-1?f.delimiterKeys.push(i):f.delimiterChars.push(i)}),f.baseDelimiter=String.fromCharCode(f.delimiterChars[0]||44),f.tagBaseClass="tm-tag",f.inputBaseClass="tm-input",n.isFunction(f.validator)||(f.validator=null),this.each(function(){var r=n(this),u="",o="",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",e,h;if(r.data("tagManager"))return!1;for(r.data("tagManager",!0),e=0;e<5;e++)o+=s.charAt(Math.floor(Math.random()*s.length));if(r.data("tm_rndid",o),r.data("opts",f).data("tlis",[]).data("tlid",[]),f.output===null?(u=n("<input/>",{type:"hidden",name:f.hiddenTagListName}),r.after(u),r.data("lhiddenTagList",u)):r.data("lhiddenTagList",n(f.output)),f.AjaxPushAllTags){r.on("tm:spliced",t.pushAllTags);r.on("tm:popped",t.pushAllTags);r.on("tm:pushed",t.pushAllTags)}r.on("focus keypress",function(){n(this).popover&&n(this).popover("hide")});if(f.isClearInputOnEsc)r.on("keyup",function(i){i.which===27&&(n(this).val(""),t.killEvent(i))});r.on("keypress",function(n){t.keyInArray(n,f.delimiterChars)&&t.applyDelimiter.call(r,n)});r.on("keydown",function(n){n.which===13&&f.preventSubmitOnEnter&&t.killEvent(n);t.keyInArray(n,f.delimiterKeys)&&t.applyDelimiter.call(r,n)});if(f.deleteTagsOnBackspace)r.on("keydown",function(u){t.keyInArray(u,f.backspace)&&n(this).val().length<=0&&(i.popTag.call(r),t.killEvent(u))});if(f.fillInputOnTagRemove)r.on("tm:popped",function(t,i){n(this).val(i)});r.change(function(n){/webkit/.test(navigator.userAgent.toLowerCase())||r.focus();t.killEvent(n)});f.prefilled!==null?typeof f.prefilled=="object"?t.prefill.call(r,f.prefilled):typeof f.prefilled=="string"?t.prefill.call(r,f.prefilled.split(f.baseDelimiter)):typeof f.prefilled=="function"&&t.prefill.call(r,f.prefilled()):f.output!==null&&(n(f.output)&&n(f.output).val()&&(h=n(f.output)),t.prefill.call(r,n(f.output).val().split(f.baseDelimiter)))}),this}};n.fn.tagsManager=function(r){var u=n(this);return(0 in this)?i[r]?i[r].apply(u,Array.prototype.slice.call(arguments,1)):typeof r!="object"&&r?(n.error("Method "+r+" does not exist."),!1):t.init.apply(this,arguments):this}})(jQuery);